(LIT "Fixer that changes xrange(...) into range(...).")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(PUNCT ".")
(KEYWORD import)
(ID "fixer_base")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(PUNCT ".")
(ID "fixer_util")
(KEYWORD import)
(ID "Name")
(PUNCT ",")
(ID "Call")
(PUNCT ",")
(ID "consuming_calls")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(PUNCT ".")
(KEYWORD import)
(ID "patcomp")
(NEWLINE)
(KEYWORD class)
(ID "FixXrange")
(PUNCT "(")
(ID "fixer_base")
(PUNCT ".")
(ID "BaseFix")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "BM_compatible")
(PUNCT "=")
(KEYWORD True)
(NEWLINE)
(ID "PATTERN")
(PUNCT "=")
(LIT "\n              power<\n                 (name='range'|name='xrange') trailer< '(' args=any ')' >\n              rest=any* >\n              ")
(NEWLINE)
(KEYWORD def)
(ID "start_tree")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "tree")
(PUNCT ",")
(ID "filename")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "super")
(PUNCT "(")
(ID "FixXrange")
(PUNCT ",")
(ID "self")
(PUNCT ")")
(PUNCT ".")
(ID "start_tree")
(PUNCT "(")
(ID "tree")
(PUNCT ",")
(ID "filename")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "transformed_xranges")
(PUNCT "=")
(ID "set")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "finish_tree")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "tree")
(PUNCT ",")
(ID "filename")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "transformed_xranges")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "transform")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "node")
(PUNCT ",")
(ID "results")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "name")
(PUNCT "=")
(ID "results")
(PUNCT "[")
(LIT "name")
(PUNCT "]")
(NEWLINE)
(KEYWORD if)
(ID "name")
(PUNCT ".")
(ID "value")
(PUNCT "==")
(LIT "xrange")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "transform_xrange")
(PUNCT "(")
(ID "node")
(PUNCT ",")
(ID "results")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "name")
(PUNCT ".")
(ID "value")
(PUNCT "==")
(LIT "range")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "transform_range")
(PUNCT "(")
(ID "node")
(PUNCT ",")
(ID "results")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(ID "ValueError")
(PUNCT "(")
(ID "repr")
(PUNCT "(")
(ID "name")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "transform_xrange")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "node")
(PUNCT ",")
(ID "results")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "name")
(PUNCT "=")
(ID "results")
(PUNCT "[")
(LIT "name")
(PUNCT "]")
(NEWLINE)
(ID "name")
(PUNCT ".")
(ID "replace")
(PUNCT "(")
(ID "Name")
(PUNCT "(")
(LIT "range")
(PUNCT ",")
(ID "prefix")
(PUNCT "=")
(ID "name")
(PUNCT ".")
(ID "prefix")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "transformed_xranges")
(PUNCT ".")
(ID "add")
(PUNCT "(")
(ID "id")
(PUNCT "(")
(ID "node")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "transform_range")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "node")
(PUNCT ",")
(ID "results")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(PUNCT "(")
(ID "id")
(PUNCT "(")
(ID "node")
(PUNCT ")")
(KEYWORD not)
(KEYWORD in)
(ID "self")
(PUNCT ".")
(ID "transformed_xranges")
(KEYWORD and)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "in_special_context")
(PUNCT "(")
(ID "node")
(PUNCT ")")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "range_call")
(PUNCT "=")
(ID "Call")
(PUNCT "(")
(ID "Name")
(PUNCT "(")
(LIT "range")
(PUNCT ")")
(PUNCT ",")
(PUNCT "[")
(ID "results")
(PUNCT "[")
(LIT "args")
(PUNCT "]")
(PUNCT ".")
(ID "clone")
(PUNCT "(")
(PUNCT ")")
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(ID "list_call")
(PUNCT "=")
(ID "Call")
(PUNCT "(")
(ID "Name")
(PUNCT "(")
(LIT "list")
(PUNCT ")")
(PUNCT ",")
(PUNCT "[")
(ID "range_call")
(PUNCT "]")
(PUNCT ",")
(ID "prefix")
(PUNCT "=")
(ID "node")
(PUNCT ".")
(ID "prefix")
(PUNCT ")")
(NEWLINE)
(KEYWORD for)
(ID "n")
(KEYWORD in)
(ID "results")
(PUNCT "[")
(LIT "rest")
(PUNCT "]")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "list_call")
(PUNCT ".")
(ID "append_child")
(PUNCT "(")
(ID "n")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD return)
(ID "list_call")
(NEWLINE)
(DEDENT)
(DEDENT)
(ID "P1")
(PUNCT "=")
(LIT "power< func=NAME trailer< '(' node=any ')' > any* >")
(NEWLINE)
(ID "p1")
(PUNCT "=")
(ID "patcomp")
(PUNCT ".")
(ID "compile_pattern")
(PUNCT "(")
(ID "P1")
(PUNCT ")")
(NEWLINE)
(ID "P2")
(PUNCT "=")
(LIT "for_stmt< 'for' any 'in' node=any ':' any* >\n            | comp_for< 'for' any 'in' node=any any* >\n            | comparison< any 'in' node=any any*>\n         ")
(NEWLINE)
(ID "p2")
(PUNCT "=")
(ID "patcomp")
(PUNCT ".")
(ID "compile_pattern")
(PUNCT "(")
(ID "P2")
(PUNCT ")")
(NEWLINE)
(KEYWORD def)
(ID "in_special_context")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "node")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "node")
(PUNCT ".")
(ID "parent")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(KEYWORD False)
(NEWLINE)
(DEDENT)
(ID "results")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(KEYWORD if)
(PUNCT "(")
(ID "node")
(PUNCT ".")
(ID "parent")
(PUNCT ".")
(ID "parent")
(KEYWORD is)
(KEYWORD not)
(KEYWORD None)
(KEYWORD and)
(ID "self")
(PUNCT ".")
(ID "p1")
(PUNCT ".")
(ID "match")
(PUNCT "(")
(ID "node")
(PUNCT ".")
(ID "parent")
(PUNCT ".")
(ID "parent")
(PUNCT ",")
(ID "results")
(PUNCT ")")
(KEYWORD and)
(ID "results")
(PUNCT "[")
(LIT "node")
(PUNCT "]")
(KEYWORD is)
(ID "node")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "results")
(PUNCT "[")
(LIT "func")
(PUNCT "]")
(PUNCT ".")
(ID "value")
(KEYWORD in)
(ID "consuming_calls")
(NEWLINE)
(DEDENT)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "p2")
(PUNCT ".")
(ID "match")
(PUNCT "(")
(ID "node")
(PUNCT ".")
(ID "parent")
(PUNCT ",")
(ID "results")
(PUNCT ")")
(KEYWORD and)
(ID "results")
(PUNCT "[")
(LIT "node")
(PUNCT "]")
(KEYWORD is)
(ID "node")
(NEWLINE)
(DEDENT)
(DEDENT)
(ENDMARKER)
