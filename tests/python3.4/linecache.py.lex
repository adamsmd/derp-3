(LIT "Cache lines from files.\n\nThis is intended to read lines from modules imported -- hence if a filename\nis not found, it will look down the module search path for a file by\nthat name.\n")
(NEWLINE)
(KEYWORD import)
(ID "sys")
(NEWLINE)
(KEYWORD import)
(ID "os")
(NEWLINE)
(KEYWORD import)
(ID "tokenize")
(NEWLINE)
(ID "__all__")
(PUNCT "=")
(PUNCT "[")
(LIT "getline")
(PUNCT ",")
(LIT "clearcache")
(PUNCT ",")
(LIT "checkcache")
(PUNCT "]")
(NEWLINE)
(KEYWORD def)
(ID "getline")
(PUNCT "(")
(ID "filename")
(PUNCT ",")
(ID "lineno")
(PUNCT ",")
(ID "module_globals")
(PUNCT "=")
(KEYWORD None)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "lines")
(PUNCT "=")
(ID "getlines")
(PUNCT "(")
(ID "filename")
(PUNCT ",")
(ID "module_globals")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(LIT 1)
(PUNCT "<=")
(ID "lineno")
(PUNCT "<=")
(ID "len")
(PUNCT "(")
(ID "lines")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "lines")
(PUNCT "[")
(ID "lineno")
(PUNCT "-")
(LIT 1)
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(LIT "")
(NEWLINE)
(DEDENT)
(DEDENT)
(ID "cache")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(KEYWORD def)
(ID "clearcache")
(PUNCT "(")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Clear the cache entirely.")
(NEWLINE)
(KEYWORD global)
(ID "cache")
(NEWLINE)
(ID "cache")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "getlines")
(PUNCT "(")
(ID "filename")
(PUNCT ",")
(ID "module_globals")
(PUNCT "=")
(KEYWORD None)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Get the lines for a file from the cache.\n    Update the cache if it doesn't contain an entry for this file already.")
(NEWLINE)
(KEYWORD if)
(ID "filename")
(KEYWORD in)
(ID "cache")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(PUNCT "[")
(LIT 2)
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "updatecache")
(PUNCT "(")
(ID "filename")
(PUNCT ",")
(ID "module_globals")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "checkcache")
(PUNCT "(")
(ID "filename")
(PUNCT "=")
(KEYWORD None)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Discard cache entries that are out of date.\n    (This is not checked upon each call!)")
(NEWLINE)
(KEYWORD if)
(ID "filename")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "filenames")
(PUNCT "=")
(ID "list")
(PUNCT "(")
(ID "cache")
(PUNCT ".")
(ID "keys")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "filename")
(KEYWORD in)
(ID "cache")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "filenames")
(PUNCT "=")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD for)
(ID "filename")
(KEYWORD in)
(ID "filenames")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "size")
(PUNCT ",")
(ID "mtime")
(PUNCT ",")
(ID "lines")
(PUNCT ",")
(ID "fullname")
(PUNCT "=")
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(NEWLINE)
(KEYWORD if)
(ID "mtime")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD continue)
(NEWLINE)
(DEDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "stat")
(PUNCT "=")
(ID "os")
(PUNCT ".")
(ID "stat")
(PUNCT "(")
(ID "fullname")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "OSError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD del)
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(NEWLINE)
(KEYWORD continue)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "size")
(PUNCT "!=")
(ID "stat")
(PUNCT ".")
(ID "st_size")
(KEYWORD or)
(ID "mtime")
(PUNCT "!=")
(ID "stat")
(PUNCT ".")
(ID "st_mtime")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD del)
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "updatecache")
(PUNCT "(")
(ID "filename")
(PUNCT ",")
(ID "module_globals")
(PUNCT "=")
(KEYWORD None)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Update a cache entry and return its list of lines.\n    If something's wrong, print a message, discard the cache entry,\n    and return an empty list.")
(NEWLINE)
(KEYWORD if)
(ID "filename")
(KEYWORD in)
(ID "cache")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD del)
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "filename")
(KEYWORD or)
(PUNCT "(")
(ID "filename")
(PUNCT ".")
(ID "startswith")
(PUNCT "(")
(LIT "<")
(PUNCT ")")
(KEYWORD and)
(ID "filename")
(PUNCT ".")
(ID "endswith")
(PUNCT "(")
(LIT ">")
(PUNCT ")")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(ID "fullname")
(PUNCT "=")
(ID "filename")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "stat")
(PUNCT "=")
(ID "os")
(PUNCT ".")
(ID "stat")
(PUNCT "(")
(ID "fullname")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "OSError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "basename")
(PUNCT "=")
(ID "filename")
(NEWLINE)
(KEYWORD if)
(ID "module_globals")
(KEYWORD and)
(LIT "__loader__")
(KEYWORD in)
(ID "module_globals")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "name")
(PUNCT "=")
(ID "module_globals")
(PUNCT ".")
(ID "get")
(PUNCT "(")
(LIT "__name__")
(PUNCT ")")
(NEWLINE)
(ID "loader")
(PUNCT "=")
(ID "module_globals")
(PUNCT "[")
(LIT "__loader__")
(PUNCT "]")
(NEWLINE)
(ID "get_source")
(PUNCT "=")
(ID "getattr")
(PUNCT "(")
(ID "loader")
(PUNCT ",")
(LIT "get_source")
(PUNCT ",")
(KEYWORD None)
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "name")
(KEYWORD and)
(ID "get_source")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "data")
(PUNCT "=")
(ID "get_source")
(PUNCT "(")
(ID "name")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(PUNCT "(")
(ID "ImportError")
(PUNCT ",")
(ID "OSError")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD pass)
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "data")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(PUNCT "=")
(PUNCT "(")
(ID "len")
(PUNCT "(")
(ID "data")
(PUNCT ")")
(PUNCT ",")
(KEYWORD None)
(PUNCT ",")
(PUNCT "[")
(ID "line")
(PUNCT "+")
(LIT "\n")
(KEYWORD for)
(ID "line")
(KEYWORD in)
(ID "data")
(PUNCT ".")
(ID "splitlines")
(PUNCT "(")
(PUNCT ")")
(PUNCT "]")
(PUNCT ",")
(ID "fullname")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(PUNCT "[")
(LIT 2)
(PUNCT "]")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD if)
(ID "os")
(PUNCT ".")
(ID "path")
(PUNCT ".")
(ID "isabs")
(PUNCT "(")
(ID "filename")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD for)
(ID "dirname")
(KEYWORD in)
(ID "sys")
(PUNCT ".")
(ID "path")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "fullname")
(PUNCT "=")
(ID "os")
(PUNCT ".")
(ID "path")
(PUNCT ".")
(ID "join")
(PUNCT "(")
(ID "dirname")
(PUNCT ",")
(ID "basename")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(PUNCT "(")
(ID "TypeError")
(PUNCT ",")
(ID "AttributeError")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD continue)
(NEWLINE)
(DEDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "stat")
(PUNCT "=")
(ID "os")
(PUNCT ".")
(ID "stat")
(PUNCT "(")
(ID "fullname")
(PUNCT ")")
(NEWLINE)
(KEYWORD break)
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "OSError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD pass)
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD with)
(ID "tokenize")
(PUNCT ".")
(ID "open")
(PUNCT "(")
(ID "fullname")
(PUNCT ")")
(KEYWORD as)
(ID "fp")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "lines")
(PUNCT "=")
(ID "fp")
(PUNCT ".")
(ID "readlines")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD except)
(ID "OSError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "lines")
(KEYWORD and)
(KEYWORD not)
(ID "lines")
(PUNCT "[")
(PUNCT "-")
(LIT 1)
(PUNCT "]")
(PUNCT ".")
(ID "endswith")
(PUNCT "(")
(LIT "\n")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "lines")
(PUNCT "[")
(PUNCT "-")
(LIT 1)
(PUNCT "]")
(PUNCT "+=")
(LIT "\n")
(NEWLINE)
(DEDENT)
(ID "size")
(PUNCT ",")
(ID "mtime")
(PUNCT "=")
(ID "stat")
(PUNCT ".")
(ID "st_size")
(PUNCT ",")
(ID "stat")
(PUNCT ".")
(ID "st_mtime")
(NEWLINE)
(ID "cache")
(PUNCT "[")
(ID "filename")
(PUNCT "]")
(PUNCT "=")
(ID "size")
(PUNCT ",")
(ID "mtime")
(PUNCT ",")
(ID "lines")
(PUNCT ",")
(ID "fullname")
(NEWLINE)
(KEYWORD return)
(ID "lines")
(NEWLINE)
(DEDENT)
(ENDMARKER)
