(LIT "An RFC 5321 smtp proxy.\n\nUsage: %(program)s [options] [localhost:localport [remotehost:remoteport]]\n\nOptions:\n\n    --nosetuid\n    -n\n        This program generally tries to setuid `nobody', unless this flag is\n        set.  The setuid call will fail if this program is not run as root (in\n        which case, use this flag).\n\n    --version\n    -V\n        Print the version number and exit.\n\n    --class classname\n    -c classname\n        Use `classname' as the concrete SMTP proxy class.  Uses `PureProxy' by\n        default.\n\n    --size limit\n    -s limit\n        Restrict the total size of the incoming message to \"limit\" number of\n        bytes via the RFC 1870 SIZE extension.  Defaults to 33554432 bytes.\n\n    --debug\n    -d\n        Turn on debugging prints.\n\n    --help\n    -h\n        Print this message and exit.\n\nVersion: %(__version__)s\n\nIf localhost is not given then `localhost' is used, and if localport is not\ngiven then 8025 is used.  If remotehost is not given then `localhost' is used,\nand if remoteport is not given, then 25 is used.\n")
(NEWLINE)
(KEYWORD import)
(ID "sys")
(NEWLINE)
(KEYWORD import)
(ID "os")
(NEWLINE)
(KEYWORD import)
(ID "errno")
(NEWLINE)
(KEYWORD import)
(ID "getopt")
(NEWLINE)
(KEYWORD import)
(ID "time")
(NEWLINE)
(KEYWORD import)
(ID "socket")
(NEWLINE)
(KEYWORD import)
(ID "asyncore")
(NEWLINE)
(KEYWORD import)
(ID "asynchat")
(NEWLINE)
(KEYWORD import)
(ID "collections")
(NEWLINE)
(KEYWORD from)
(ID "warnings")
(KEYWORD import)
(ID "warn")
(NEWLINE)
(KEYWORD from)
(ID "email")
(PUNCT ".")
(ID "_header_value_parser")
(KEYWORD import)
(ID "get_addr_spec")
(PUNCT ",")
(ID "get_angle_addr")
(NEWLINE)
(ID "__all__")
(PUNCT "=")
(PUNCT "[")
(LIT "SMTPServer")
(PUNCT ",")
(LIT "DebuggingServer")
(PUNCT ",")
(LIT "PureProxy")
(PUNCT ",")
(LIT "MailmanProxy")
(PUNCT "]")
(NEWLINE)
(ID "program")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "argv")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(NEWLINE)
(ID "__version__")
(PUNCT "=")
(LIT "Python SMTP proxy version 0.3")
(NEWLINE)
(KEYWORD class)
(ID "Devnull")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD def)
(ID "write")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "msg")
(PUNCT ")")
(PUNCT ":")
(KEYWORD pass)
(NEWLINE)
(KEYWORD def)
(ID "flush")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(KEYWORD pass)
(NEWLINE)
(DEDENT)
(ID "DEBUGSTREAM")
(PUNCT "=")
(ID "Devnull")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "NEWLINE")
(PUNCT "=")
(LIT "\n")
(NEWLINE)
(ID "EMPTYSTRING")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "COMMASPACE")
(PUNCT "=")
(LIT ", ")
(NEWLINE)
(ID "DATA_SIZE_DEFAULT")
(PUNCT "=")
(LIT 33554432)
(NEWLINE)
(KEYWORD def)
(ID "usage")
(PUNCT "(")
(ID "code")
(PUNCT ",")
(ID "msg")
(PUNCT "=")
(LIT "")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(ID "__doc__")
(PUNCT "%")
(ID "globals")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "stderr")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "msg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(ID "msg")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "stderr")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "sys")
(PUNCT ".")
(ID "exit")
(PUNCT "(")
(ID "code")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD class)
(ID "SMTPChannel")
(PUNCT "(")
(ID "asynchat")
(PUNCT ".")
(ID "async_chat")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "COMMAND")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(ID "DATA")
(PUNCT "=")
(LIT 1)
(NEWLINE)
(ID "command_size_limit")
(PUNCT "=")
(LIT 512)
(NEWLINE)
(ID "command_size_limits")
(PUNCT "=")
(ID "collections")
(PUNCT ".")
(ID "defaultdict")
(PUNCT "(")
(KEYWORD lambda)
(ID "x")
(PUNCT "=")
(ID "command_size_limit")
(PUNCT ":")
(ID "x")
(PUNCT ")")
(NEWLINE)
(ID "command_size_limits")
(PUNCT ".")
(ID "update")
(PUNCT "(")
(PUNCT "{")
(LIT "MAIL")
(PUNCT ":")
(ID "command_size_limit")
(PUNCT "+")
(LIT 26)
(PUNCT ",")
(PUNCT "}")
(PUNCT ")")
(NEWLINE)
(ID "max_command_size_limit")
(PUNCT "=")
(ID "max")
(PUNCT "(")
(ID "command_size_limits")
(PUNCT ".")
(ID "values")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "server")
(PUNCT ",")
(ID "conn")
(PUNCT ",")
(ID "addr")
(PUNCT ",")
(ID "data_size_limit")
(PUNCT "=")
(ID "DATA_SIZE_DEFAULT")
(PUNCT ",")
(ID "map")
(PUNCT "=")
(KEYWORD None)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "asynchat")
(PUNCT ".")
(ID "async_chat")
(PUNCT ".")
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "conn")
(PUNCT ",")
(ID "map")
(PUNCT "=")
(ID "map")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "smtp_server")
(PUNCT "=")
(ID "server")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "conn")
(PUNCT "=")
(ID "conn")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "addr")
(PUNCT "=")
(ID "addr")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(PUNCT "=")
(ID "data_size_limit")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "received_lines")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "COMMAND")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "received_data")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "fqdn")
(PUNCT "=")
(ID "socket")
(PUNCT ".")
(ID "getfqdn")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "peer")
(PUNCT "=")
(ID "conn")
(PUNCT ".")
(ID "getpeername")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "OSError")
(KEYWORD as)
(ID "err")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "close")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "err")
(PUNCT ".")
(ID "args")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT "!=")
(ID "errno")
(PUNCT ".")
(ID "ENOTCONN")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(NEWLINE)
(DEDENT)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "print")
(PUNCT "(")
(LIT "Peer:")
(PUNCT ",")
(ID "repr")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "peer")
(PUNCT ")")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "220 %s %s")
(PUNCT "%")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "fqdn")
(PUNCT ",")
(ID "__version__")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "set_terminator")
(PUNCT "(")
(LIT #"\r\n")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT "=")
(KEYWORD False)
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__server")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __server attribute on SMTPChannel is deprecated, ")
(LIT "use 'smtp_server' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "smtp_server")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__server")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__server")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __server attribute on SMTPChannel is deprecated, ")
(LIT "set 'smtp_server' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "smtp_server")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__line")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __line attribute on SMTPChannel is deprecated, ")
(LIT "use 'received_lines' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "received_lines")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__line")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__line")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __line attribute on SMTPChannel is deprecated, ")
(LIT "set 'received_lines' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "received_lines")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__state")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __state attribute on SMTPChannel is deprecated, ")
(LIT "use 'smtp_state' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__state")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__state")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __state attribute on SMTPChannel is deprecated, ")
(LIT "set 'smtp_state' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__greeting")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __greeting attribute on SMTPChannel is deprecated, ")
(LIT "use 'seen_greeting' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__greeting")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__greeting")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __greeting attribute on SMTPChannel is deprecated, ")
(LIT "set 'seen_greeting' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__mailfrom")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __mailfrom attribute on SMTPChannel is deprecated, ")
(LIT "use 'mailfrom' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__mailfrom")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__mailfrom")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __mailfrom attribute on SMTPChannel is deprecated, ")
(LIT "set 'mailfrom' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__rcpttos")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __rcpttos attribute on SMTPChannel is deprecated, ")
(LIT "use 'rcpttos' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__rcpttos")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__rcpttos")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __rcpttos attribute on SMTPChannel is deprecated, ")
(LIT "set 'rcpttos' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__data")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __data attribute on SMTPChannel is deprecated, ")
(LIT "use 'received_data' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "received_data")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__data")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__data")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __data attribute on SMTPChannel is deprecated, ")
(LIT "set 'received_data' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "received_data")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__fqdn")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __fqdn attribute on SMTPChannel is deprecated, ")
(LIT "use 'fqdn' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "fqdn")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__fqdn")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__fqdn")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __fqdn attribute on SMTPChannel is deprecated, ")
(LIT "set 'fqdn' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "fqdn")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__peer")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __peer attribute on SMTPChannel is deprecated, ")
(LIT "use 'peer' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "peer")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__peer")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__peer")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __peer attribute on SMTPChannel is deprecated, ")
(LIT "set 'peer' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "peer")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__conn")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __conn attribute on SMTPChannel is deprecated, ")
(LIT "use 'conn' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "conn")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__conn")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__conn")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __conn attribute on SMTPChannel is deprecated, ")
(LIT "set 'conn' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "conn")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "property")
(NEWLINE)
(KEYWORD def)
(ID "__addr")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Access to __addr attribute on SMTPChannel is deprecated, ")
(LIT "use 'addr' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "addr")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "__addr")
(PUNCT ".")
(ID "setter")
(NEWLINE)
(KEYWORD def)
(ID "__addr")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "warn")
(PUNCT "(")
(LIT "Setting __addr attribute on SMTPChannel is deprecated, ")
(LIT "set 'addr' instead")
(PUNCT ",")
(ID "DeprecationWarning")
(PUNCT ",")
(LIT 2)
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "addr")
(PUNCT "=")
(ID "value")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "push")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "msg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "asynchat")
(PUNCT ".")
(ID "async_chat")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "bytes")
(PUNCT "(")
(ID "msg")
(PUNCT "+")
(LIT "\r\n")
(PUNCT ",")
(LIT "ascii")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "collect_incoming_data")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "limit")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "==")
(ID "self")
(PUNCT ".")
(ID "COMMAND")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "limit")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "max_command_size_limit")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "==")
(ID "self")
(PUNCT ".")
(ID "DATA")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "limit")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "limit")
(KEYWORD and)
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT ">")
(ID "limit")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "limit")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT "+=")
(ID "len")
(PUNCT "(")
(ID "data")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "received_lines")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(ID "str")
(PUNCT "(")
(ID "data")
(PUNCT ",")
(LIT "utf-8")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "found_terminator")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "line")
(PUNCT "=")
(ID "EMPTYSTRING")
(PUNCT ".")
(ID "join")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "received_lines")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "Data:")
(PUNCT ",")
(ID "repr")
(PUNCT "(")
(ID "line")
(PUNCT ")")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "received_lines")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "==")
(ID "self")
(PUNCT ".")
(ID "COMMAND")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "sz")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT ",")
(LIT 0)
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "line")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "500 Error: bad syntax")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "method")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(ID "i")
(PUNCT "=")
(ID "line")
(PUNCT ".")
(ID "find")
(PUNCT "(")
(LIT " ")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "i")
(PUNCT "<")
(LIT 0)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "command")
(PUNCT "=")
(ID "line")
(PUNCT ".")
(ID "upper")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "arg")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "command")
(PUNCT "=")
(ID "line")
(PUNCT "[")
(PUNCT ":")
(ID "i")
(PUNCT "]")
(PUNCT ".")
(ID "upper")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "arg")
(PUNCT "=")
(ID "line")
(PUNCT "[")
(ID "i")
(PUNCT "+")
(LIT 1)
(PUNCT ":")
(PUNCT "]")
(PUNCT ".")
(ID "strip")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "max_sz")
(PUNCT "=")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "command_size_limits")
(PUNCT "[")
(ID "command")
(PUNCT "]")
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(KEYWORD else)
(ID "self")
(PUNCT ".")
(ID "command_size_limit")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "sz")
(PUNCT ">")
(ID "max_sz")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "500 Error: line too long")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "method")
(PUNCT "=")
(ID "getattr")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(LIT "smtp_")
(PUNCT "+")
(ID "command")
(PUNCT ",")
(KEYWORD None)
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "method")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "500 Error: command \"%s\" not recognized")
(PUNCT "%")
(ID "command")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "method")
(PUNCT "(")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "!=")
(ID "self")
(PUNCT ".")
(ID "DATA")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "451 Internal confusion")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(KEYWORD and)
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT ">")
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "552 Error: Too much mail data")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "data")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(KEYWORD for)
(ID "text")
(KEYWORD in)
(ID "line")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT "\r\n")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "text")
(KEYWORD and)
(ID "text")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT "==")
(LIT ".")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "data")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(ID "text")
(PUNCT "[")
(LIT 1)
(PUNCT ":")
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "data")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(ID "text")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "received_data")
(PUNCT "=")
(ID "NEWLINE")
(PUNCT ".")
(ID "join")
(PUNCT "(")
(ID "data")
(PUNCT ")")
(NEWLINE)
(ID "status")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "smtp_server")
(PUNCT ".")
(ID "process_message")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "peer")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "received_data")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "COMMAND")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "num_bytes")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "set_terminator")
(PUNCT "(")
(LIT #"\r\n")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "status")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 OK")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "status")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "smtp_HELO")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Syntax: HELO hostname")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Duplicate HELO/EHLO")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT "=")
(ID "arg")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT "=")
(KEYWORD False)
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 %s")
(PUNCT "%")
(ID "self")
(PUNCT ".")
(ID "fqdn")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "smtp_EHLO")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Syntax: EHLO hostname")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Duplicate HELO/EHLO")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT "=")
(ID "arg")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT "=")
(KEYWORD True)
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250-%s")
(PUNCT "%")
(ID "self")
(PUNCT ".")
(ID "fqdn")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250-SIZE %s")
(PUNCT "%")
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 HELP")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "smtp_NOOP")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Syntax: NOOP")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 OK")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "smtp_QUIT")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "221 Bye")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "close_when_done")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_strip_command_keyword")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "keyword")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "keylen")
(PUNCT "=")
(ID "len")
(PUNCT "(")
(ID "keyword")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "arg")
(PUNCT "[")
(PUNCT ":")
(ID "keylen")
(PUNCT "]")
(PUNCT ".")
(ID "upper")
(PUNCT "(")
(PUNCT ")")
(PUNCT "==")
(ID "keyword")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "arg")
(PUNCT "[")
(ID "keylen")
(PUNCT ":")
(PUNCT "]")
(PUNCT ".")
(ID "strip")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD return)
(LIT "")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_getaddr")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(LIT "")
(PUNCT ",")
(LIT "")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "arg")
(PUNCT ".")
(ID "lstrip")
(PUNCT "(")
(PUNCT ")")
(PUNCT ".")
(ID "startswith")
(PUNCT "(")
(LIT "<")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "address")
(PUNCT ",")
(ID "rest")
(PUNCT "=")
(ID "get_angle_addr")
(PUNCT "(")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "address")
(PUNCT ",")
(ID "rest")
(PUNCT "=")
(ID "get_addr_spec")
(PUNCT "(")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "address")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "address")
(PUNCT ",")
(ID "rest")
(NEWLINE)
(DEDENT)
(KEYWORD return)
(ID "address")
(PUNCT ".")
(ID "addr_spec")
(PUNCT ",")
(ID "rest")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_getparams")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "params")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "params")
(PUNCT "=")
(PUNCT "[")
(ID "param")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT "=")
(PUNCT ",")
(LIT 1)
(PUNCT ")")
(KEYWORD for)
(ID "param")
(KEYWORD in)
(ID "params")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(PUNCT ")")
(KEYWORD if)
(LIT "=")
(KEYWORD in)
(ID "param")
(PUNCT "]")
(NEWLINE)
(KEYWORD return)
(PUNCT "{")
(ID "k")
(PUNCT ":")
(ID "v")
(KEYWORD for)
(ID "k")
(PUNCT ",")
(ID "v")
(KEYWORD in)
(ID "params")
(KEYWORD if)
(ID "k")
(PUNCT ".")
(ID "isalnum")
(PUNCT "(")
(PUNCT ")")
(PUNCT "}")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "smtp_HELP")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "extended")
(PUNCT "=")
(LIT " [SP <mail parameters]")
(NEWLINE)
(ID "lc_arg")
(PUNCT "=")
(ID "arg")
(PUNCT ".")
(ID "upper")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "lc_arg")
(PUNCT "==")
(LIT "EHLO")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Syntax: EHLO hostname")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "HELO")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Syntax: HELO hostname")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "MAIL")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "=")
(LIT "250 Syntax: MAIL FROM: <address>")
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "+=")
(ID "extended")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "msg")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "RCPT")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "=")
(LIT "250 Syntax: RCPT TO: <address>")
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "+=")
(ID "extended")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "msg")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "DATA")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Syntax: DATA")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "RSET")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Syntax: RSET")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "NOOP")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Syntax: NOOP")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "QUIT")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Syntax: QUIT")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "lc_arg")
(PUNCT "==")
(LIT "VRFY")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Syntax: VRFY <address>")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Supported commands: EHLO HELO MAIL RCPT ")
(LIT "DATA RSET NOOP QUIT VRFY")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 Supported commands: EHLO HELO MAIL RCPT DATA ")
(LIT "RSET NOOP QUIT VRFY")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "smtp_VRFY")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "address")
(PUNCT ",")
(ID "params")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_getaddr")
(PUNCT "(")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "address")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "252 Cannot VRFY user, but will accept message ")
(LIT "and attempt delivery")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "502 Could not VRFY %s")
(PUNCT "%")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Syntax: VRFY <address>")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "smtp_MAIL")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Error: send HELO first")
(PUNCT ")")
(PUNCT ";")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "print")
(PUNCT "(")
(LIT "===> MAIL")
(PUNCT ",")
(ID "arg")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "syntaxerr")
(PUNCT "=")
(LIT "501 Syntax: MAIL FROM: <address>")
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "syntaxerr")
(PUNCT "+=")
(LIT " [SP <mail-parameters>]")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "arg")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "arg")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_strip_command_keyword")
(PUNCT "(")
(LIT "FROM:")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(ID "address")
(PUNCT ",")
(ID "params")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_getaddr")
(PUNCT "(")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "address")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(KEYWORD and)
(ID "params")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "address")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Error: nested MAIL command")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "params")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_getparams")
(PUNCT "(")
(ID "params")
(PUNCT ".")
(ID "upper")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "params")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "size")
(PUNCT "=")
(ID "params")
(PUNCT ".")
(ID "pop")
(PUNCT "(")
(LIT "SIZE")
(PUNCT ",")
(KEYWORD None)
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "size")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "size")
(PUNCT ".")
(ID "isdigit")
(PUNCT "(")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(KEYWORD and)
(ID "int")
(PUNCT "(")
(ID "size")
(PUNCT ")")
(PUNCT ">")
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "552 Error: message size exceeds fixed maximum message size")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD if)
(ID "len")
(PUNCT "(")
(ID "params")
(PUNCT ".")
(ID "keys")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(PUNCT ">")
(LIT 0)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "555 MAIL FROM parameters not recognized or not implemented")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT "=")
(ID "address")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "sender:")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 OK")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "smtp_RCPT")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Error: send HELO first")
(PUNCT ")")
(PUNCT ";")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "print")
(PUNCT "(")
(LIT "===> RCPT")
(PUNCT ",")
(ID "arg")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Error: need MAIL command")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "syntaxerr")
(PUNCT "=")
(LIT "501 Syntax: RCPT TO: <address>")
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "syntaxerr")
(PUNCT "+=")
(LIT " [SP <mail-parameters>]")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "arg")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "arg")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_strip_command_keyword")
(PUNCT "(")
(LIT "TO:")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(ID "address")
(PUNCT ",")
(ID "params")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_getaddr")
(PUNCT "(")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "address")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "params")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "extended_smtp")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "params")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_getparams")
(PUNCT "(")
(ID "params")
(PUNCT ".")
(ID "upper")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "params")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "address")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(ID "syntaxerr")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "params")
(KEYWORD and)
(ID "len")
(PUNCT "(")
(ID "params")
(PUNCT ".")
(ID "keys")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(PUNCT ">")
(LIT 0)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "555 RCPT TO parameters not recognized or not implemented")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "address")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Syntax: RCPT TO: <address>")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(ID "address")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "recips:")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 OK")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "smtp_RSET")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Syntax: RSET")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "mailfrom")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "received_data")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "COMMAND")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "250 OK")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "smtp_DATA")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "seen_greeting")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Error: send HELO first")
(PUNCT ")")
(PUNCT ";")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "rcpttos")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "503 Error: need RCPT command")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "arg")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "501 Syntax: DATA")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "smtp_state")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "DATA")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "set_terminator")
(PUNCT "(")
(LIT #"\r\n.\r\n")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "354 End data with <CR><LF>.<CR><LF>")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "smtp_EXPN")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "arg")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "push")
(PUNCT "(")
(LIT "502 EXPN not implemented")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "SMTPServer")
(PUNCT "(")
(ID "asyncore")
(PUNCT ".")
(ID "dispatcher")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "channel_class")
(PUNCT "=")
(ID "SMTPChannel")
(NEWLINE)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "localaddr")
(PUNCT ",")
(ID "remoteaddr")
(PUNCT ",")
(ID "data_size_limit")
(PUNCT "=")
(ID "DATA_SIZE_DEFAULT")
(PUNCT ",")
(ID "map")
(PUNCT "=")
(KEYWORD None)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_localaddr")
(PUNCT "=")
(ID "localaddr")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_remoteaddr")
(PUNCT "=")
(ID "remoteaddr")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(PUNCT "=")
(ID "data_size_limit")
(NEWLINE)
(ID "asyncore")
(PUNCT ".")
(ID "dispatcher")
(PUNCT ".")
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "map")
(PUNCT "=")
(ID "map")
(PUNCT ")")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "create_socket")
(PUNCT "(")
(ID "socket")
(PUNCT ".")
(ID "AF_INET")
(PUNCT ",")
(ID "socket")
(PUNCT ".")
(ID "SOCK_STREAM")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "set_reuse_addr")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "bind")
(PUNCT "(")
(ID "localaddr")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "listen")
(PUNCT "(")
(LIT 5)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "close")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD raise)
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "%s started at %s\n\tLocal addr: %s\n\tRemote addr:%s")
(PUNCT "%")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "__class__")
(PUNCT ".")
(ID "__name__")
(PUNCT ",")
(ID "time")
(PUNCT ".")
(ID "ctime")
(PUNCT "(")
(ID "time")
(PUNCT ".")
(ID "time")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(PUNCT ",")
(ID "localaddr")
(PUNCT ",")
(ID "remoteaddr")
(PUNCT ")")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "handle_accepted")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "conn")
(PUNCT ",")
(ID "addr")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "Incoming connection from %s")
(PUNCT "%")
(ID "repr")
(PUNCT "(")
(ID "addr")
(PUNCT ")")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "channel")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "channel_class")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "conn")
(PUNCT ",")
(ID "addr")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "data_size_limit")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "_map")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "process_message")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "peer")
(PUNCT ",")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Override this abstract method to handle messages from the client.\n\n        peer is a tuple containing (ipaddr, port) of the client that made the\n        socket connection to our smtp port.\n\n        mailfrom is the raw address the client claims the message is coming\n        from.\n\n        rcpttos is a list of raw addresses the client wishes to deliver the\n        message to.\n\n        data is a string containing the entire full text of the message,\n        headers (if supplied) and all.  It has been `de-transparencied'\n        according to RFC 821, Section 4.5.2.  In other words, a line\n        containing a `.' followed by other text has had the leading dot\n        removed.\n\n        This function should return None, for a normal `250 Ok' response;\n        otherwise it returns the desired response string in RFC 821 format.\n\n        ")
(NEWLINE)
(KEYWORD raise)
(ID "NotImplementedError")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "DebuggingServer")
(PUNCT "(")
(ID "SMTPServer")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD def)
(ID "process_message")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "peer")
(PUNCT ",")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "inheaders")
(PUNCT "=")
(LIT 1)
(NEWLINE)
(ID "lines")
(PUNCT "=")
(ID "data")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT "\n")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "---------- MESSAGE FOLLOWS ----------")
(PUNCT ")")
(NEWLINE)
(KEYWORD for)
(ID "line")
(KEYWORD in)
(ID "lines")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "inheaders")
(KEYWORD and)
(KEYWORD not)
(ID "line")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "X-Peer:")
(PUNCT ",")
(ID "peer")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(ID "inheaders")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(DEDENT)
(ID "print")
(PUNCT "(")
(ID "line")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "print")
(PUNCT "(")
(LIT "------------ END MESSAGE ------------")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "PureProxy")
(PUNCT "(")
(ID "SMTPServer")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD def)
(ID "process_message")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "peer")
(PUNCT ",")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "lines")
(PUNCT "=")
(ID "data")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT "\n")
(PUNCT ")")
(NEWLINE)
(ID "i")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(KEYWORD for)
(ID "line")
(KEYWORD in)
(ID "lines")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(KEYWORD not)
(ID "line")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD break)
(NEWLINE)
(DEDENT)
(ID "i")
(PUNCT "+=")
(LIT 1)
(NEWLINE)
(DEDENT)
(ID "lines")
(PUNCT ".")
(ID "insert")
(PUNCT "(")
(ID "i")
(PUNCT ",")
(LIT "X-Peer: %s")
(PUNCT "%")
(ID "peer")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(ID "data")
(PUNCT "=")
(ID "NEWLINE")
(PUNCT ".")
(ID "join")
(PUNCT "(")
(ID "lines")
(PUNCT ")")
(NEWLINE)
(ID "refused")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_deliver")
(PUNCT "(")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "we got some refusals:")
(PUNCT ",")
(ID "refused")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_deliver")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD import)
(ID "smtplib")
(NEWLINE)
(ID "refused")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "s")
(PUNCT "=")
(ID "smtplib")
(PUNCT ".")
(ID "SMTP")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "s")
(PUNCT ".")
(ID "connect")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_remoteaddr")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "_remoteaddr")
(PUNCT "[")
(LIT 1)
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "refused")
(PUNCT "=")
(ID "s")
(PUNCT ".")
(ID "sendmail")
(PUNCT "(")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD finally)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "s")
(PUNCT ".")
(ID "quit")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD except)
(ID "smtplib")
(PUNCT ".")
(ID "SMTPRecipientsRefused")
(KEYWORD as)
(ID "e")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "got SMTPRecipientsRefused")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "refused")
(PUNCT "=")
(ID "e")
(PUNCT ".")
(ID "recipients")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(PUNCT "(")
(ID "OSError")
(PUNCT ",")
(ID "smtplib")
(PUNCT ".")
(ID "SMTPException")
(PUNCT ")")
(KEYWORD as)
(ID "e")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "got")
(PUNCT ",")
(ID "e")
(PUNCT ".")
(ID "__class__")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "errcode")
(PUNCT "=")
(ID "getattr")
(PUNCT "(")
(ID "e")
(PUNCT ",")
(LIT "smtp_code")
(PUNCT ",")
(PUNCT "-")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(ID "errmsg")
(PUNCT "=")
(ID "getattr")
(PUNCT "(")
(ID "e")
(PUNCT ",")
(LIT "smtp_error")
(PUNCT ",")
(LIT "ignore")
(PUNCT ")")
(NEWLINE)
(KEYWORD for)
(ID "r")
(KEYWORD in)
(ID "rcpttos")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "refused")
(PUNCT "[")
(ID "r")
(PUNCT "]")
(PUNCT "=")
(PUNCT "(")
(ID "errcode")
(PUNCT ",")
(ID "errmsg")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD return)
(ID "refused")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "MailmanProxy")
(PUNCT "(")
(ID "PureProxy")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD def)
(ID "process_message")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "peer")
(PUNCT ",")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD from)
(ID "io")
(KEYWORD import)
(ID "StringIO")
(NEWLINE)
(KEYWORD from)
(ID "Mailman")
(KEYWORD import)
(ID "Utils")
(NEWLINE)
(KEYWORD from)
(ID "Mailman")
(KEYWORD import)
(ID "Message")
(NEWLINE)
(KEYWORD from)
(ID "Mailman")
(KEYWORD import)
(ID "MailList")
(NEWLINE)
(ID "listnames")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(KEYWORD for)
(ID "rcpt")
(KEYWORD in)
(ID "rcpttos")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "local")
(PUNCT "=")
(ID "rcpt")
(PUNCT ".")
(ID "lower")
(PUNCT "(")
(PUNCT ")")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT "@")
(PUNCT ")")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(NEWLINE)
(ID "parts")
(PUNCT "=")
(ID "local")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT "-")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "len")
(PUNCT "(")
(ID "parts")
(PUNCT ")")
(PUNCT ">")
(LIT 2)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD continue)
(NEWLINE)
(DEDENT)
(ID "listname")
(PUNCT "=")
(ID "parts")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(NEWLINE)
(KEYWORD if)
(ID "len")
(PUNCT "(")
(ID "parts")
(PUNCT ")")
(PUNCT "==")
(LIT 2)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "command")
(PUNCT "=")
(ID "parts")
(PUNCT "[")
(LIT 1)
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "command")
(PUNCT "=")
(LIT "")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "Utils")
(PUNCT ".")
(ID "list_exists")
(PUNCT "(")
(ID "listname")
(PUNCT ")")
(KEYWORD or)
(ID "command")
(KEYWORD not)
(KEYWORD in)
(PUNCT "(")
(LIT "")
(PUNCT ",")
(LIT "admin")
(PUNCT ",")
(LIT "owner")
(PUNCT ",")
(LIT "request")
(PUNCT ",")
(LIT "join")
(PUNCT ",")
(LIT "leave")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD continue)
(NEWLINE)
(DEDENT)
(ID "listnames")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(PUNCT "(")
(ID "rcpt")
(PUNCT ",")
(ID "listname")
(PUNCT ",")
(ID "command")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD for)
(ID "rcpt")
(PUNCT ",")
(ID "listname")
(PUNCT ",")
(ID "command")
(KEYWORD in)
(ID "listnames")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "rcpttos")
(PUNCT ".")
(ID "remove")
(PUNCT "(")
(ID "rcpt")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "print")
(PUNCT "(")
(LIT "forwarding recips:")
(PUNCT ",")
(LIT " ")
(PUNCT ".")
(ID "join")
(PUNCT "(")
(ID "rcpttos")
(PUNCT ")")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "rcpttos")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "refused")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_deliver")
(PUNCT "(")
(ID "mailfrom")
(PUNCT ",")
(ID "rcpttos")
(PUNCT ",")
(ID "data")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "we got refusals:")
(PUNCT ",")
(ID "refused")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "mlists")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(ID "s")
(PUNCT "=")
(ID "StringIO")
(PUNCT "(")
(ID "data")
(PUNCT ")")
(NEWLINE)
(ID "msg")
(PUNCT "=")
(ID "Message")
(PUNCT ".")
(ID "Message")
(PUNCT "(")
(ID "s")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "msg")
(PUNCT ".")
(ID "get")
(PUNCT "(")
(LIT "from")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "[")
(LIT "From")
(PUNCT "]")
(PUNCT "=")
(ID "mailfrom")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "msg")
(PUNCT ".")
(ID "get")
(PUNCT "(")
(LIT "date")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "[")
(LIT "Date")
(PUNCT "]")
(PUNCT "=")
(ID "time")
(PUNCT ".")
(ID "ctime")
(PUNCT "(")
(ID "time")
(PUNCT ".")
(ID "time")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD for)
(ID "rcpt")
(PUNCT ",")
(ID "listname")
(PUNCT ",")
(ID "command")
(KEYWORD in)
(ID "listnames")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "sending message to")
(PUNCT ",")
(ID "rcpt")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "DEBUGSTREAM")
(PUNCT ")")
(NEWLINE)
(ID "mlist")
(PUNCT "=")
(ID "mlists")
(PUNCT ".")
(ID "get")
(PUNCT "(")
(ID "listname")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "mlist")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "mlist")
(PUNCT "=")
(ID "MailList")
(PUNCT ".")
(ID "MailList")
(PUNCT "(")
(ID "listname")
(PUNCT ",")
(ID "lock")
(PUNCT "=")
(LIT 0)
(PUNCT ")")
(NEWLINE)
(ID "mlists")
(PUNCT "[")
(ID "listname")
(PUNCT "]")
(PUNCT "=")
(ID "mlist")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "command")
(PUNCT "==")
(LIT "")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT ".")
(ID "Enqueue")
(PUNCT "(")
(ID "mlist")
(PUNCT ",")
(ID "tolist")
(PUNCT "=")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "command")
(PUNCT "==")
(LIT "admin")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT ".")
(ID "Enqueue")
(PUNCT "(")
(ID "mlist")
(PUNCT ",")
(ID "toadmin")
(PUNCT "=")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "command")
(PUNCT "==")
(LIT "owner")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT ".")
(ID "Enqueue")
(PUNCT "(")
(ID "mlist")
(PUNCT ",")
(ID "toowner")
(PUNCT "=")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "command")
(PUNCT "==")
(LIT "request")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT ".")
(ID "Enqueue")
(PUNCT "(")
(ID "mlist")
(PUNCT ",")
(ID "torequest")
(PUNCT "=")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "command")
(KEYWORD in)
(PUNCT "(")
(LIT "join")
(PUNCT ",")
(LIT "leave")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "command")
(PUNCT "==")
(LIT "join")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "[")
(LIT "Subject")
(PUNCT "]")
(PUNCT "=")
(LIT "subscribe")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msg")
(PUNCT "[")
(LIT "Subject")
(PUNCT "]")
(PUNCT "=")
(LIT "unsubscribe")
(NEWLINE)
(DEDENT)
(ID "msg")
(PUNCT ".")
(ID "Enqueue")
(PUNCT "(")
(ID "mlist")
(PUNCT ",")
(ID "torequest")
(PUNCT "=")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "Options")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "setuid")
(PUNCT "=")
(LIT 1)
(NEWLINE)
(ID "classname")
(PUNCT "=")
(LIT "PureProxy")
(NEWLINE)
(ID "size_limit")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "parseargs")
(PUNCT "(")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD global)
(ID "DEBUGSTREAM")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "opts")
(PUNCT ",")
(ID "args")
(PUNCT "=")
(ID "getopt")
(PUNCT ".")
(ID "getopt")
(PUNCT "(")
(ID "sys")
(PUNCT ".")
(ID "argv")
(PUNCT "[")
(LIT 1)
(PUNCT ":")
(PUNCT "]")
(PUNCT ",")
(LIT "nVhc:s:d")
(PUNCT ",")
(PUNCT "[")
(LIT "class=")
(PUNCT ",")
(LIT "nosetuid")
(PUNCT ",")
(LIT "version")
(PUNCT ",")
(LIT "help")
(PUNCT ",")
(LIT "size=")
(PUNCT ",")
(LIT "debug")
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "getopt")
(PUNCT ".")
(ID "error")
(KEYWORD as)
(ID "e")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "usage")
(PUNCT "(")
(LIT 1)
(PUNCT ",")
(ID "e")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "options")
(PUNCT "=")
(ID "Options")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD for)
(ID "opt")
(PUNCT ",")
(ID "arg")
(KEYWORD in)
(ID "opts")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "opt")
(KEYWORD in)
(PUNCT "(")
(LIT "-h")
(PUNCT ",")
(LIT "--help")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "usage")
(PUNCT "(")
(LIT 0)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "opt")
(KEYWORD in)
(PUNCT "(")
(LIT "-V")
(PUNCT ",")
(LIT "--version")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(ID "__version__")
(PUNCT ")")
(NEWLINE)
(ID "sys")
(PUNCT ".")
(ID "exit")
(PUNCT "(")
(LIT 0)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "opt")
(KEYWORD in)
(PUNCT "(")
(LIT "-n")
(PUNCT ",")
(LIT "--nosetuid")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "options")
(PUNCT ".")
(ID "setuid")
(PUNCT "=")
(LIT 0)
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "opt")
(KEYWORD in)
(PUNCT "(")
(LIT "-c")
(PUNCT ",")
(LIT "--class")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "options")
(PUNCT ".")
(ID "classname")
(PUNCT "=")
(ID "arg")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "opt")
(KEYWORD in)
(PUNCT "(")
(LIT "-d")
(PUNCT ",")
(LIT "--debug")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "DEBUGSTREAM")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "stderr")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "opt")
(KEYWORD in)
(PUNCT "(")
(LIT "-s")
(PUNCT ",")
(LIT "--size")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "int_size")
(PUNCT "=")
(ID "int")
(PUNCT "(")
(ID "arg")
(PUNCT ")")
(NEWLINE)
(ID "options")
(PUNCT ".")
(ID "size_limit")
(PUNCT "=")
(ID "int_size")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "Invalid size: ")
(PUNCT "+")
(ID "arg")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "stderr")
(PUNCT ")")
(NEWLINE)
(ID "sys")
(PUNCT ".")
(ID "exit")
(PUNCT "(")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD if)
(ID "len")
(PUNCT "(")
(ID "args")
(PUNCT ")")
(PUNCT "<")
(LIT 1)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "localspec")
(PUNCT "=")
(LIT "localhost:8025")
(NEWLINE)
(ID "remotespec")
(PUNCT "=")
(LIT "localhost:25")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "len")
(PUNCT "(")
(ID "args")
(PUNCT ")")
(PUNCT "<")
(LIT 2)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "localspec")
(PUNCT "=")
(ID "args")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(NEWLINE)
(ID "remotespec")
(PUNCT "=")
(LIT "localhost:25")
(NEWLINE)
(DEDENT)
(KEYWORD elif)
(ID "len")
(PUNCT "(")
(ID "args")
(PUNCT ")")
(PUNCT "<")
(LIT 3)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "localspec")
(PUNCT "=")
(ID "args")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(NEWLINE)
(ID "remotespec")
(PUNCT "=")
(ID "args")
(PUNCT "[")
(LIT 1)
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "usage")
(PUNCT "(")
(LIT 1)
(PUNCT ",")
(LIT "Invalid arguments: %s")
(PUNCT "%")
(ID "COMMASPACE")
(PUNCT ".")
(ID "join")
(PUNCT "(")
(ID "args")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "i")
(PUNCT "=")
(ID "localspec")
(PUNCT ".")
(ID "find")
(PUNCT "(")
(LIT ":")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "i")
(PUNCT "<")
(LIT 0)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "usage")
(PUNCT "(")
(LIT 1)
(PUNCT ",")
(LIT "Bad local spec: %s")
(PUNCT "%")
(ID "localspec")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "options")
(PUNCT ".")
(ID "localhost")
(PUNCT "=")
(ID "localspec")
(PUNCT "[")
(PUNCT ":")
(ID "i")
(PUNCT "]")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "options")
(PUNCT ".")
(ID "localport")
(PUNCT "=")
(ID "int")
(PUNCT "(")
(ID "localspec")
(PUNCT "[")
(ID "i")
(PUNCT "+")
(LIT 1)
(PUNCT ":")
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "ValueError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "usage")
(PUNCT "(")
(LIT 1)
(PUNCT ",")
(LIT "Bad local port: %s")
(PUNCT "%")
(ID "localspec")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "i")
(PUNCT "=")
(ID "remotespec")
(PUNCT ".")
(ID "find")
(PUNCT "(")
(LIT ":")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "i")
(PUNCT "<")
(LIT 0)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "usage")
(PUNCT "(")
(LIT 1)
(PUNCT ",")
(LIT "Bad remote spec: %s")
(PUNCT "%")
(ID "remotespec")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "options")
(PUNCT ".")
(ID "remotehost")
(PUNCT "=")
(ID "remotespec")
(PUNCT "[")
(PUNCT ":")
(ID "i")
(PUNCT "]")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "options")
(PUNCT ".")
(ID "remoteport")
(PUNCT "=")
(ID "int")
(PUNCT "(")
(ID "remotespec")
(PUNCT "[")
(ID "i")
(PUNCT "+")
(LIT 1)
(PUNCT ":")
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "ValueError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "usage")
(PUNCT "(")
(LIT 1)
(PUNCT ",")
(LIT "Bad remote port: %s")
(PUNCT "%")
(ID "remotespec")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD return)
(ID "options")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "__name__")
(PUNCT "==")
(LIT "__main__")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "options")
(PUNCT "=")
(ID "parseargs")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "classname")
(PUNCT "=")
(ID "options")
(PUNCT ".")
(ID "classname")
(NEWLINE)
(KEYWORD if)
(LIT ".")
(KEYWORD in)
(ID "classname")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "lastdot")
(PUNCT "=")
(ID "classname")
(PUNCT ".")
(ID "rfind")
(PUNCT "(")
(LIT ".")
(PUNCT ")")
(NEWLINE)
(ID "mod")
(PUNCT "=")
(ID "__import__")
(PUNCT "(")
(ID "classname")
(PUNCT "[")
(PUNCT ":")
(ID "lastdot")
(PUNCT "]")
(PUNCT ",")
(ID "globals")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(ID "locals")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(PUNCT "[")
(LIT "")
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(ID "classname")
(PUNCT "=")
(ID "classname")
(PUNCT "[")
(ID "lastdot")
(PUNCT "+")
(LIT 1)
(PUNCT ":")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD import)
(ID "__main__")
(KEYWORD as)
(ID "mod")
(NEWLINE)
(DEDENT)
(ID "class_")
(PUNCT "=")
(ID "getattr")
(PUNCT "(")
(ID "mod")
(PUNCT ",")
(ID "classname")
(PUNCT ")")
(NEWLINE)
(ID "proxy")
(PUNCT "=")
(ID "class_")
(PUNCT "(")
(PUNCT "(")
(ID "options")
(PUNCT ".")
(ID "localhost")
(PUNCT ",")
(ID "options")
(PUNCT ".")
(ID "localport")
(PUNCT ")")
(PUNCT ",")
(PUNCT "(")
(ID "options")
(PUNCT ".")
(ID "remotehost")
(PUNCT ",")
(ID "options")
(PUNCT ".")
(ID "remoteport")
(PUNCT ")")
(PUNCT ",")
(ID "options")
(PUNCT ".")
(ID "size_limit")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "options")
(PUNCT ".")
(ID "setuid")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD import)
(ID "pwd")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "ImportError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "Cannot import module \"pwd\"; try running with -n option.")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "stderr")
(PUNCT ")")
(NEWLINE)
(ID "sys")
(PUNCT ".")
(ID "exit")
(PUNCT "(")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "nobody")
(PUNCT "=")
(ID "pwd")
(PUNCT ".")
(ID "getpwnam")
(PUNCT "(")
(LIT "nobody")
(PUNCT ")")
(PUNCT "[")
(LIT 2)
(PUNCT "]")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "os")
(PUNCT ".")
(ID "setuid")
(PUNCT "(")
(ID "nobody")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "PermissionError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(LIT "Cannot setuid \"nobody\"; try running with -n option.")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "stderr")
(PUNCT ")")
(NEWLINE)
(ID "sys")
(PUNCT ".")
(ID "exit")
(PUNCT "(")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "asyncore")
(PUNCT ".")
(ID "loop")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "KeyboardInterrupt")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD pass)
(NEWLINE)
(DEDENT)
(DEDENT)
(ENDMARKER)
