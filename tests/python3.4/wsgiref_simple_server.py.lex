(LIT "BaseHTTPServer that implements the Python WSGI protocol (PEP 3333)\n\nThis is both an example of how WSGI can be implemented, and a basis for running\nsimple web applications on a local machine, such as might be done when testing\nor debugging an application.  It has not been reviewed for security issues,\nhowever, and we strongly recommend that you use a \"real\" web server for\nproduction use.\n\nFor example usage, see the 'if __name__==\"__main__\"' block at the end of the\nmodule.  See also the BaseHTTPServer module docs for other API information.\n")
(NEWLINE)
(KEYWORD from)
(ID "http")
(PUNCT ".")
(ID "server")
(KEYWORD import)
(ID "BaseHTTPRequestHandler")
(PUNCT ",")
(ID "HTTPServer")
(NEWLINE)
(KEYWORD import)
(ID "sys")
(NEWLINE)
(KEYWORD import)
(ID "urllib")
(PUNCT ".")
(ID "parse")
(NEWLINE)
(KEYWORD from)
(ID "wsgiref")
(PUNCT ".")
(ID "handlers")
(KEYWORD import)
(ID "SimpleHandler")
(NEWLINE)
(KEYWORD from)
(ID "platform")
(KEYWORD import)
(ID "python_implementation")
(NEWLINE)
(ID "__version__")
(PUNCT "=")
(LIT "0.2")
(NEWLINE)
(ID "__all__")
(PUNCT "=")
(PUNCT "[")
(LIT "WSGIServer")
(PUNCT ",")
(LIT "WSGIRequestHandler")
(PUNCT ",")
(LIT "demo_app")
(PUNCT ",")
(LIT "make_server")
(PUNCT "]")
(NEWLINE)
(ID "server_version")
(PUNCT "=")
(LIT "WSGIServer/")
(PUNCT "+")
(ID "__version__")
(NEWLINE)
(ID "sys_version")
(PUNCT "=")
(ID "python_implementation")
(PUNCT "(")
(PUNCT ")")
(PUNCT "+")
(LIT "/")
(PUNCT "+")
(ID "sys")
(PUNCT ".")
(ID "version")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(PUNCT ")")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(NEWLINE)
(ID "software_version")
(PUNCT "=")
(ID "server_version")
(PUNCT "+")
(LIT " ")
(PUNCT "+")
(ID "sys_version")
(NEWLINE)
(KEYWORD class)
(ID "ServerHandler")
(PUNCT "(")
(ID "SimpleHandler")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "server_software")
(PUNCT "=")
(ID "software_version")
(NEWLINE)
(KEYWORD def)
(ID "close")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "request_handler")
(PUNCT ".")
(ID "log_request")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "status")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT " ")
(PUNCT ",")
(LIT 1)
(PUNCT ")")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "bytes_sent")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD finally)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "SimpleHandler")
(PUNCT ".")
(ID "close")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "WSGIServer")
(PUNCT "(")
(ID "HTTPServer")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "BaseHTTPServer that implements the Python WSGI protocol")
(NEWLINE)
(ID "application")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(KEYWORD def)
(ID "server_bind")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Override server_bind to store the server name.")
(NEWLINE)
(ID "HTTPServer")
(PUNCT ".")
(ID "server_bind")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "setup_environ")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "setup_environ")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "base_environ")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "SERVER_NAME")
(PUNCT "]")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "server_name")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "GATEWAY_INTERFACE")
(PUNCT "]")
(PUNCT "=")
(LIT "CGI/1.1")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "SERVER_PORT")
(PUNCT "]")
(PUNCT "=")
(ID "str")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "server_port")
(PUNCT ")")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "REMOTE_HOST")
(PUNCT "]")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "CONTENT_LENGTH")
(PUNCT "]")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "SCRIPT_NAME")
(PUNCT "]")
(PUNCT "=")
(LIT "")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "get_app")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "application")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "set_app")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "application")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "application")
(PUNCT "=")
(ID "application")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "WSGIRequestHandler")
(PUNCT "(")
(ID "BaseHTTPRequestHandler")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "server_version")
(PUNCT "=")
(LIT "WSGIServer/")
(PUNCT "+")
(ID "__version__")
(NEWLINE)
(KEYWORD def)
(ID "get_environ")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "server")
(PUNCT ".")
(ID "base_environ")
(PUNCT ".")
(ID "copy")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "SERVER_PROTOCOL")
(PUNCT "]")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "request_version")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "SERVER_SOFTWARE")
(PUNCT "]")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "server_version")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "REQUEST_METHOD")
(PUNCT "]")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "command")
(NEWLINE)
(KEYWORD if)
(LIT "?")
(KEYWORD in)
(ID "self")
(PUNCT ".")
(ID "path")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "path")
(PUNCT ",")
(ID "query")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "path")
(PUNCT ".")
(ID "split")
(PUNCT "(")
(LIT "?")
(PUNCT ",")
(LIT 1)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "path")
(PUNCT ",")
(ID "query")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "path")
(PUNCT ",")
(LIT "")
(NEWLINE)
(DEDENT)
(ID "env")
(PUNCT "[")
(LIT "PATH_INFO")
(PUNCT "]")
(PUNCT "=")
(ID "urllib")
(PUNCT ".")
(ID "parse")
(PUNCT ".")
(ID "unquote_to_bytes")
(PUNCT "(")
(ID "path")
(PUNCT ")")
(PUNCT ".")
(ID "decode")
(PUNCT "(")
(LIT "iso-8859-1")
(PUNCT ")")
(NEWLINE)
(ID "env")
(PUNCT "[")
(LIT "QUERY_STRING")
(PUNCT "]")
(PUNCT "=")
(ID "query")
(NEWLINE)
(ID "host")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "address_string")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "host")
(PUNCT "!=")
(ID "self")
(PUNCT ".")
(ID "client_address")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "[")
(LIT "REMOTE_HOST")
(PUNCT "]")
(PUNCT "=")
(ID "host")
(NEWLINE)
(DEDENT)
(ID "env")
(PUNCT "[")
(LIT "REMOTE_ADDR")
(PUNCT "]")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "client_address")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(NEWLINE)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "headers")
(PUNCT ".")
(ID "get")
(PUNCT "(")
(LIT "content-type")
(PUNCT ")")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "[")
(LIT "CONTENT_TYPE")
(PUNCT "]")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "headers")
(PUNCT ".")
(ID "get_content_type")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "[")
(LIT "CONTENT_TYPE")
(PUNCT "]")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "headers")
(PUNCT "[")
(LIT "content-type")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(ID "length")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "headers")
(PUNCT ".")
(ID "get")
(PUNCT "(")
(LIT "content-length")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "length")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "[")
(LIT "CONTENT_LENGTH")
(PUNCT "]")
(PUNCT "=")
(ID "length")
(NEWLINE)
(DEDENT)
(KEYWORD for)
(ID "k")
(PUNCT ",")
(ID "v")
(KEYWORD in)
(ID "self")
(PUNCT ".")
(ID "headers")
(PUNCT ".")
(ID "items")
(PUNCT "(")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "k")
(PUNCT "=")
(ID "k")
(PUNCT ".")
(ID "replace")
(PUNCT "(")
(LIT "-")
(PUNCT ",")
(LIT "_")
(PUNCT ")")
(PUNCT ".")
(ID "upper")
(PUNCT "(")
(PUNCT ")")
(PUNCT ";")
(ID "v")
(PUNCT "=")
(ID "v")
(PUNCT ".")
(ID "strip")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "k")
(KEYWORD in)
(ID "env")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD continue)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(LIT "HTTP_")
(PUNCT "+")
(ID "k")
(KEYWORD in)
(ID "env")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "[")
(LIT "HTTP_")
(PUNCT "+")
(ID "k")
(PUNCT "]")
(PUNCT "+=")
(LIT ",")
(PUNCT "+")
(ID "v")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "env")
(PUNCT "[")
(LIT "HTTP_")
(PUNCT "+")
(ID "k")
(PUNCT "]")
(PUNCT "=")
(ID "v")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD return)
(ID "env")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "get_stderr")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "sys")
(PUNCT ".")
(ID "stderr")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "handle")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Handle a single HTTP request")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "raw_requestline")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "rfile")
(PUNCT ".")
(ID "readline")
(PUNCT "(")
(LIT 65537)
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "len")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "raw_requestline")
(PUNCT ")")
(PUNCT ">")
(LIT 65536)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "requestline")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "request_version")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "command")
(PUNCT "=")
(LIT "")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "send_error")
(PUNCT "(")
(LIT 414)
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "parse_request")
(PUNCT "(")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(NEWLINE)
(DEDENT)
(ID "handler")
(PUNCT "=")
(ID "ServerHandler")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "rfile")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "wfile")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "get_stderr")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "get_environ")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "handler")
(PUNCT ".")
(ID "request_handler")
(PUNCT "=")
(ID "self")
(NEWLINE)
(ID "handler")
(PUNCT ".")
(ID "run")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "server")
(PUNCT ".")
(ID "get_app")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "demo_app")
(PUNCT "(")
(ID "environ")
(PUNCT ",")
(ID "start_response")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD from)
(ID "io")
(KEYWORD import)
(ID "StringIO")
(NEWLINE)
(ID "stdout")
(PUNCT "=")
(ID "StringIO")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "Hello world!")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "stdout")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(ID "file")
(PUNCT "=")
(ID "stdout")
(PUNCT ")")
(NEWLINE)
(ID "h")
(PUNCT "=")
(ID "sorted")
(PUNCT "(")
(ID "environ")
(PUNCT ".")
(ID "items")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(KEYWORD for)
(ID "k")
(PUNCT ",")
(ID "v")
(KEYWORD in)
(ID "h")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "print")
(PUNCT "(")
(ID "k")
(PUNCT ",")
(LIT "=")
(PUNCT ",")
(ID "repr")
(PUNCT "(")
(ID "v")
(PUNCT ")")
(PUNCT ",")
(ID "file")
(PUNCT "=")
(ID "stdout")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "start_response")
(PUNCT "(")
(LIT "200 OK")
(PUNCT ",")
(PUNCT "[")
(PUNCT "(")
(LIT "Content-Type")
(PUNCT ",")
(LIT "text/plain; charset=utf-8")
(PUNCT ")")
(PUNCT "]")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(PUNCT "[")
(ID "stdout")
(PUNCT ".")
(ID "getvalue")
(PUNCT "(")
(PUNCT ")")
(PUNCT ".")
(ID "encode")
(PUNCT "(")
(LIT "utf-8")
(PUNCT ")")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "make_server")
(PUNCT "(")
(ID "host")
(PUNCT ",")
(ID "port")
(PUNCT ",")
(ID "app")
(PUNCT ",")
(ID "server_class")
(PUNCT "=")
(ID "WSGIServer")
(PUNCT ",")
(ID "handler_class")
(PUNCT "=")
(ID "WSGIRequestHandler")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Create a new WSGI server listening on `host` and `port` for `app`")
(NEWLINE)
(ID "server")
(PUNCT "=")
(ID "server_class")
(PUNCT "(")
(PUNCT "(")
(ID "host")
(PUNCT ",")
(ID "port")
(PUNCT ")")
(PUNCT ",")
(ID "handler_class")
(PUNCT ")")
(NEWLINE)
(ID "server")
(PUNCT ".")
(ID "set_app")
(PUNCT "(")
(ID "app")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "server")
(NEWLINE)
(DEDENT)
(KEYWORD if)
(ID "__name__")
(PUNCT "==")
(LIT "__main__")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "httpd")
(PUNCT "=")
(ID "make_server")
(PUNCT "(")
(LIT "")
(PUNCT ",")
(LIT 8000)
(PUNCT ",")
(ID "demo_app")
(PUNCT ")")
(NEWLINE)
(ID "sa")
(PUNCT "=")
(ID "httpd")
(PUNCT ".")
(ID "socket")
(PUNCT ".")
(ID "getsockname")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "print")
(PUNCT "(")
(LIT "Serving HTTP on")
(PUNCT ",")
(ID "sa")
(PUNCT "[")
(LIT 0)
(PUNCT "]")
(PUNCT ",")
(LIT "port")
(PUNCT ",")
(ID "sa")
(PUNCT "[")
(LIT 1)
(PUNCT "]")
(PUNCT ",")
(LIT "...")
(PUNCT ")")
(NEWLINE)
(KEYWORD import)
(ID "webbrowser")
(NEWLINE)
(ID "webbrowser")
(PUNCT ".")
(ID "open")
(PUNCT "(")
(LIT "http://localhost:8000/xyz?abc")
(PUNCT ")")
(NEWLINE)
(ID "httpd")
(PUNCT ".")
(ID "handle_request")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "httpd")
(PUNCT ".")
(ID "server_close")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ENDMARKER)
