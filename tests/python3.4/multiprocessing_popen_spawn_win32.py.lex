(KEYWORD import)
(ID "os")
(NEWLINE)
(KEYWORD import)
(ID "msvcrt")
(NEWLINE)
(KEYWORD import)
(ID "signal")
(NEWLINE)
(KEYWORD import)
(ID "sys")
(NEWLINE)
(KEYWORD import)
(ID "_winapi")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(KEYWORD import)
(ID "context")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(KEYWORD import)
(ID "spawn")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(KEYWORD import)
(ID "reduction")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(KEYWORD import)
(ID "util")
(NEWLINE)
(ID "__all__")
(PUNCT "=")
(PUNCT "[")
(LIT "Popen")
(PUNCT "]")
(NEWLINE)
(ID "TERMINATE")
(PUNCT "=")
(LIT 65536)
(NEWLINE)
(ID "WINEXE")
(PUNCT "=")
(PUNCT "(")
(ID "sys")
(PUNCT ".")
(ID "platform")
(PUNCT "==")
(LIT "win32")
(KEYWORD and)
(ID "getattr")
(PUNCT "(")
(ID "sys")
(PUNCT ",")
(LIT "frozen")
(PUNCT ",")
(KEYWORD False)
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "WINSERVICE")
(PUNCT "=")
(ID "sys")
(PUNCT ".")
(ID "executable")
(PUNCT ".")
(ID "lower")
(PUNCT "(")
(PUNCT ")")
(PUNCT ".")
(ID "endswith")
(PUNCT "(")
(LIT "pythonservice.exe")
(PUNCT ")")
(NEWLINE)
(KEYWORD class)
(ID "Popen")
(PUNCT "(")
(ID "object")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "\n    Start a subprocess to run the code of a process object\n    ")
(NEWLINE)
(ID "method")
(PUNCT "=")
(LIT "spawn")
(NEWLINE)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "process_obj")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "prep_data")
(PUNCT "=")
(ID "spawn")
(PUNCT ".")
(ID "get_preparation_data")
(PUNCT "(")
(ID "process_obj")
(PUNCT ".")
(ID "_name")
(PUNCT ")")
(NEWLINE)
(ID "rhandle")
(PUNCT ",")
(ID "whandle")
(PUNCT "=")
(ID "_winapi")
(PUNCT ".")
(ID "CreatePipe")
(PUNCT "(")
(KEYWORD None)
(PUNCT ",")
(LIT 0)
(PUNCT ")")
(NEWLINE)
(ID "wfd")
(PUNCT "=")
(ID "msvcrt")
(PUNCT ".")
(ID "open_osfhandle")
(PUNCT "(")
(ID "whandle")
(PUNCT ",")
(LIT 0)
(PUNCT ")")
(NEWLINE)
(ID "cmd")
(PUNCT "=")
(ID "spawn")
(PUNCT ".")
(ID "get_command_line")
(PUNCT "(")
(ID "parent_pid")
(PUNCT "=")
(ID "os")
(PUNCT ".")
(ID "getpid")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(ID "pipe_handle")
(PUNCT "=")
(ID "rhandle")
(PUNCT ")")
(NEWLINE)
(ID "cmd")
(PUNCT "=")
(LIT " ")
(PUNCT ".")
(ID "join")
(PUNCT "(")
(LIT "\"%s\"")
(PUNCT "%")
(ID "x")
(KEYWORD for)
(ID "x")
(KEYWORD in)
(ID "cmd")
(PUNCT ")")
(NEWLINE)
(KEYWORD with)
(ID "open")
(PUNCT "(")
(ID "wfd")
(PUNCT ",")
(LIT "wb")
(PUNCT ",")
(ID "closefd")
(PUNCT "=")
(KEYWORD True)
(PUNCT ")")
(KEYWORD as)
(ID "to_child")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "hp")
(PUNCT ",")
(ID "ht")
(PUNCT ",")
(ID "pid")
(PUNCT ",")
(ID "tid")
(PUNCT "=")
(ID "_winapi")
(PUNCT ".")
(ID "CreateProcess")
(PUNCT "(")
(ID "spawn")
(PUNCT ".")
(ID "get_executable")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(ID "cmd")
(PUNCT ",")
(KEYWORD None)
(PUNCT ",")
(KEYWORD None)
(PUNCT ",")
(KEYWORD False)
(PUNCT ",")
(LIT 0)
(PUNCT ",")
(KEYWORD None)
(PUNCT ",")
(KEYWORD None)
(PUNCT ",")
(KEYWORD None)
(PUNCT ")")
(NEWLINE)
(ID "_winapi")
(PUNCT ".")
(ID "CloseHandle")
(PUNCT "(")
(ID "ht")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "_winapi")
(PUNCT ".")
(ID "CloseHandle")
(PUNCT "(")
(ID "rhandle")
(PUNCT ")")
(NEWLINE)
(KEYWORD raise)
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "pid")
(PUNCT "=")
(ID "pid")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "returncode")
(PUNCT "=")
(KEYWORD None)
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_handle")
(PUNCT "=")
(ID "hp")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "sentinel")
(PUNCT "=")
(ID "int")
(PUNCT "(")
(ID "hp")
(PUNCT ")")
(NEWLINE)
(ID "util")
(PUNCT ".")
(ID "Finalize")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "_winapi")
(PUNCT ".")
(ID "CloseHandle")
(PUNCT ",")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "sentinel")
(PUNCT ",")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "context")
(PUNCT ".")
(ID "set_spawning_popen")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "reduction")
(PUNCT ".")
(ID "dump")
(PUNCT "(")
(ID "prep_data")
(PUNCT ",")
(ID "to_child")
(PUNCT ")")
(NEWLINE)
(ID "reduction")
(PUNCT ".")
(ID "dump")
(PUNCT "(")
(ID "process_obj")
(PUNCT ",")
(ID "to_child")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD finally)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "context")
(PUNCT ".")
(ID "set_spawning_popen")
(PUNCT "(")
(KEYWORD None)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "duplicate_for_child")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "handle")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD assert)
(ID "self")
(KEYWORD is)
(ID "context")
(PUNCT ".")
(ID "get_spawning_popen")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "reduction")
(PUNCT ".")
(ID "duplicate")
(PUNCT "(")
(ID "handle")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "sentinel")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "wait")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "timeout")
(PUNCT "=")
(KEYWORD None)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "returncode")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "timeout")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msecs")
(PUNCT "=")
(ID "_winapi")
(PUNCT ".")
(ID "INFINITE")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "msecs")
(PUNCT "=")
(ID "max")
(PUNCT "(")
(LIT 0)
(PUNCT ",")
(ID "int")
(PUNCT "(")
(ID "timeout")
(PUNCT "*")
(LIT 1000)
(PUNCT "+")
(LIT 0.5)
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "res")
(PUNCT "=")
(ID "_winapi")
(PUNCT ".")
(ID "WaitForSingleObject")
(PUNCT "(")
(ID "int")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_handle")
(PUNCT ")")
(PUNCT ",")
(ID "msecs")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "res")
(PUNCT "==")
(ID "_winapi")
(PUNCT ".")
(ID "WAIT_OBJECT_0")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "code")
(PUNCT "=")
(ID "_winapi")
(PUNCT ".")
(ID "GetExitCodeProcess")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_handle")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "code")
(PUNCT "==")
(ID "TERMINATE")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "code")
(PUNCT "=")
(PUNCT "-")
(ID "signal")
(PUNCT ".")
(ID "SIGTERM")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "returncode")
(PUNCT "=")
(ID "code")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "returncode")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "poll")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "wait")
(PUNCT "(")
(ID "timeout")
(PUNCT "=")
(LIT 0)
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "terminate")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "returncode")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "_winapi")
(PUNCT ".")
(ID "TerminateProcess")
(PUNCT "(")
(ID "int")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_handle")
(PUNCT ")")
(PUNCT ",")
(ID "TERMINATE")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "OSError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "self")
(PUNCT ".")
(ID "wait")
(PUNCT "(")
(ID "timeout")
(PUNCT "=")
(LIT 1.0)
(PUNCT ")")
(KEYWORD is)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(DEDENT)
(DEDENT)
(ENDMARKER)
