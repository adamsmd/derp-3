(KEYWORD import)
(ID "bisect")
(NEWLINE)
(KEYWORD import)
(ID "mmap")
(NEWLINE)
(KEYWORD import)
(ID "os")
(NEWLINE)
(KEYWORD import)
(ID "sys")
(NEWLINE)
(KEYWORD import)
(ID "tempfile")
(NEWLINE)
(KEYWORD import)
(ID "threading")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(KEYWORD import)
(ID "context")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(KEYWORD import)
(ID "reduction")
(NEWLINE)
(KEYWORD from)
(PUNCT ".")
(KEYWORD import)
(ID "util")
(NEWLINE)
(ID "__all__")
(PUNCT "=")
(PUNCT "[")
(LIT "BufferWrapper")
(PUNCT "]")
(NEWLINE)
(KEYWORD if)
(ID "sys")
(PUNCT ".")
(ID "platform")
(PUNCT "==")
(LIT "win32")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD import)
(ID "_winapi")
(NEWLINE)
(KEYWORD class)
(ID "Arena")
(PUNCT "(")
(ID "object")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "_rand")
(PUNCT "=")
(ID "tempfile")
(PUNCT ".")
(ID "_RandomNameSequence")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "size")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "size")
(PUNCT "=")
(ID "size")
(NEWLINE)
(KEYWORD for)
(ID "i")
(KEYWORD in)
(ID "range")
(PUNCT "(")
(LIT 100)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "name")
(PUNCT "=")
(LIT "pym-%d-%s")
(PUNCT "%")
(PUNCT "(")
(ID "os")
(PUNCT ".")
(ID "getpid")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(ID "next")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_rand")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "buf")
(PUNCT "=")
(ID "mmap")
(PUNCT ".")
(ID "mmap")
(PUNCT "(")
(PUNCT "-")
(LIT 1)
(PUNCT ",")
(ID "size")
(PUNCT ",")
(ID "tagname")
(PUNCT "=")
(ID "name")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "_winapi")
(PUNCT ".")
(ID "GetLastError")
(PUNCT "(")
(PUNCT ")")
(PUNCT "==")
(LIT 0)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD break)
(NEWLINE)
(DEDENT)
(ID "buf")
(PUNCT ".")
(ID "close")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(ID "FileExistsError")
(PUNCT "(")
(LIT "Cannot find name for new mmap")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "name")
(PUNCT "=")
(ID "name")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "buffer")
(PUNCT "=")
(ID "buf")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_state")
(PUNCT "=")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "size")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "name")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "__getstate__")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "context")
(PUNCT ".")
(ID "assert_spawning")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "_state")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "__setstate__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "state")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "size")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "name")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_state")
(PUNCT "=")
(ID "state")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "buffer")
(PUNCT "=")
(ID "mmap")
(PUNCT ".")
(ID "mmap")
(PUNCT "(")
(PUNCT "-")
(LIT 1)
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "size")
(PUNCT ",")
(ID "tagname")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "name")
(PUNCT ")")
(NEWLINE)
(KEYWORD assert)
(ID "_winapi")
(PUNCT ".")
(ID "GetLastError")
(PUNCT "(")
(PUNCT ")")
(PUNCT "==")
(ID "_winapi")
(PUNCT ".")
(ID "ERROR_ALREADY_EXISTS")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD class)
(ID "Arena")
(PUNCT "(")
(ID "object")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "size")
(PUNCT ",")
(ID "fd")
(PUNCT "=")
(PUNCT "-")
(LIT 1)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "size")
(PUNCT "=")
(ID "size")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "fd")
(PUNCT "=")
(ID "fd")
(NEWLINE)
(KEYWORD if)
(ID "fd")
(PUNCT "==")
(PUNCT "-")
(LIT 1)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "fd")
(PUNCT ",")
(ID "name")
(PUNCT "=")
(ID "tempfile")
(PUNCT ".")
(ID "mkstemp")
(PUNCT "(")
(ID "prefix")
(PUNCT "=")
(LIT "pym-%d-")
(PUNCT "%")
(ID "os")
(PUNCT ".")
(ID "getpid")
(PUNCT "(")
(PUNCT ")")
(PUNCT ",")
(ID "dir")
(PUNCT "=")
(ID "util")
(PUNCT ".")
(ID "get_temp_dir")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "os")
(PUNCT ".")
(ID "unlink")
(PUNCT "(")
(ID "name")
(PUNCT ")")
(NEWLINE)
(ID "util")
(PUNCT ".")
(ID "Finalize")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "os")
(PUNCT ".")
(ID "close")
(PUNCT ",")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "fd")
(PUNCT ",")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(KEYWORD with)
(ID "open")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "fd")
(PUNCT ",")
(LIT "wb")
(PUNCT ",")
(ID "closefd")
(PUNCT "=")
(KEYWORD False)
(PUNCT ")")
(KEYWORD as)
(ID "f")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "f")
(PUNCT ".")
(ID "write")
(PUNCT "(")
(LIT #"\0")
(PUNCT "*")
(ID "size")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "buffer")
(PUNCT "=")
(ID "mmap")
(PUNCT ".")
(ID "mmap")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "fd")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "size")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "reduce_arena")
(PUNCT "(")
(ID "a")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "a")
(PUNCT ".")
(ID "fd")
(PUNCT "==")
(PUNCT "-")
(LIT 1)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(ID "ValueError")
(PUNCT "(")
(LIT "Arena is unpicklable because ")
(LIT "forking was enabled when it was created")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD return)
(ID "rebuild_arena")
(PUNCT ",")
(PUNCT "(")
(ID "a")
(PUNCT ".")
(ID "size")
(PUNCT ",")
(ID "reduction")
(PUNCT ".")
(ID "DupFd")
(PUNCT "(")
(ID "a")
(PUNCT ".")
(ID "fd")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "rebuild_arena")
(PUNCT "(")
(ID "size")
(PUNCT ",")
(ID "dupfd")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "Arena")
(PUNCT "(")
(ID "size")
(PUNCT ",")
(ID "dupfd")
(PUNCT ".")
(ID "detach")
(PUNCT "(")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "reduction")
(PUNCT ".")
(ID "register")
(PUNCT "(")
(ID "Arena")
(PUNCT ",")
(ID "reduce_arena")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD class)
(ID "Heap")
(PUNCT "(")
(ID "object")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "_alignment")
(PUNCT "=")
(LIT 8)
(NEWLINE)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "size")
(PUNCT "=")
(ID "mmap")
(PUNCT ".")
(ID "PAGESIZE")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_lastpid")
(PUNCT "=")
(ID "os")
(PUNCT ".")
(ID "getpid")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_lock")
(PUNCT "=")
(ID "threading")
(PUNCT ".")
(ID "Lock")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_size")
(PUNCT "=")
(ID "size")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_lengths")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_len_to_seq")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_start_to_block")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_stop_to_block")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_allocated_blocks")
(PUNCT "=")
(ID "set")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_arenas")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_pending_free_blocks")
(PUNCT "=")
(PUNCT "[")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(PUNCT "@")
(ID "staticmethod")
(NEWLINE)
(KEYWORD def)
(ID "_roundup")
(PUNCT "(")
(ID "n")
(PUNCT ",")
(ID "alignment")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "mask")
(PUNCT "=")
(ID "alignment")
(PUNCT "-")
(LIT 1)
(NEWLINE)
(KEYWORD return)
(PUNCT "(")
(ID "n")
(PUNCT "+")
(ID "mask")
(PUNCT ")")
(PUNCT "&")
(PUNCT "~")
(ID "mask")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_malloc")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "size")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "i")
(PUNCT "=")
(ID "bisect")
(PUNCT ".")
(ID "bisect_left")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_lengths")
(PUNCT ",")
(ID "size")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "i")
(PUNCT "==")
(ID "len")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_lengths")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "length")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_roundup")
(PUNCT "(")
(ID "max")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_size")
(PUNCT ",")
(ID "size")
(PUNCT ")")
(PUNCT ",")
(ID "mmap")
(PUNCT ".")
(ID "PAGESIZE")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_size")
(PUNCT "*=")
(LIT 2)
(NEWLINE)
(ID "util")
(PUNCT ".")
(ID "info")
(PUNCT "(")
(LIT "allocating a new mmap of length %d")
(PUNCT ",")
(ID "length")
(PUNCT ")")
(NEWLINE)
(ID "arena")
(PUNCT "=")
(ID "Arena")
(PUNCT "(")
(ID "length")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_arenas")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(ID "arena")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(LIT 0)
(PUNCT ",")
(ID "length")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "length")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_lengths")
(PUNCT "[")
(ID "i")
(PUNCT "]")
(NEWLINE)
(ID "seq")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_len_to_seq")
(PUNCT "[")
(ID "length")
(PUNCT "]")
(NEWLINE)
(ID "block")
(PUNCT "=")
(ID "seq")
(PUNCT ".")
(ID "pop")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "seq")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD del)
(ID "self")
(PUNCT ".")
(ID "_len_to_seq")
(PUNCT "[")
(ID "length")
(PUNCT "]")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "_lengths")
(PUNCT "[")
(ID "i")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(DEDENT)
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "=")
(ID "block")
(NEWLINE)
(KEYWORD del)
(ID "self")
(PUNCT ".")
(ID "_start_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ")")
(PUNCT "]")
(NEWLINE)
(KEYWORD del)
(ID "self")
(PUNCT ".")
(ID "_stop_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "]")
(NEWLINE)
(KEYWORD return)
(ID "block")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_free")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "block")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "=")
(ID "block")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "prev_block")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_stop_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ")")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "KeyError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD pass)
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "start")
(PUNCT ",")
(ID "_")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_absorb")
(PUNCT "(")
(ID "prev_block")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "next_block")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_start_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "KeyError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD pass)
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "_")
(PUNCT ",")
(ID "stop")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_absorb")
(PUNCT "(")
(ID "next_block")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "block")
(PUNCT "=")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(NEWLINE)
(ID "length")
(PUNCT "=")
(ID "stop")
(PUNCT "-")
(ID "start")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_len_to_seq")
(PUNCT "[")
(ID "length")
(PUNCT "]")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "KeyError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_len_to_seq")
(PUNCT "[")
(ID "length")
(PUNCT "]")
(PUNCT "=")
(PUNCT "[")
(ID "block")
(PUNCT "]")
(NEWLINE)
(ID "bisect")
(PUNCT ".")
(ID "insort")
(PUNCT "(")
(ID "self")
(PUNCT ".")
(ID "_lengths")
(PUNCT ",")
(ID "length")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "_start_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ")")
(PUNCT "]")
(PUNCT "=")
(ID "block")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_stop_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "]")
(PUNCT "=")
(ID "block")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_absorb")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "block")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "=")
(ID "block")
(NEWLINE)
(KEYWORD del)
(ID "self")
(PUNCT ".")
(ID "_start_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ")")
(PUNCT "]")
(NEWLINE)
(KEYWORD del)
(ID "self")
(PUNCT ".")
(ID "_stop_to_block")
(PUNCT "[")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "]")
(NEWLINE)
(ID "length")
(PUNCT "=")
(ID "stop")
(PUNCT "-")
(ID "start")
(NEWLINE)
(ID "seq")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_len_to_seq")
(PUNCT "[")
(ID "length")
(PUNCT "]")
(NEWLINE)
(ID "seq")
(PUNCT ".")
(ID "remove")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "seq")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD del)
(ID "self")
(PUNCT ".")
(ID "_len_to_seq")
(PUNCT "[")
(ID "length")
(PUNCT "]")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_lengths")
(PUNCT ".")
(ID "remove")
(PUNCT "(")
(ID "length")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD return)
(ID "start")
(PUNCT ",")
(ID "stop")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "_free_pending_blocks")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD while)
(KEYWORD True)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "block")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_pending_free_blocks")
(PUNCT ".")
(ID "pop")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "IndexError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD break)
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "_allocated_blocks")
(PUNCT ".")
(ID "remove")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_free")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "free")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "block")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD assert)
(ID "os")
(PUNCT ".")
(ID "getpid")
(PUNCT "(")
(PUNCT ")")
(PUNCT "==")
(ID "self")
(PUNCT ".")
(ID "_lastpid")
(NEWLINE)
(KEYWORD if)
(KEYWORD not)
(ID "self")
(PUNCT ".")
(ID "_lock")
(PUNCT ".")
(ID "acquire")
(PUNCT "(")
(KEYWORD False)
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_pending_free_blocks")
(PUNCT ".")
(ID "append")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD else)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_free_pending_blocks")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_allocated_blocks")
(PUNCT ".")
(ID "remove")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_free")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD finally)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_lock")
(PUNCT ".")
(ID "release")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "malloc")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "size")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD assert)
(LIT 0)
(PUNCT "<=")
(ID "size")
(PUNCT "<")
(ID "sys")
(PUNCT ".")
(ID "maxsize")
(NEWLINE)
(KEYWORD if)
(ID "os")
(PUNCT ".")
(ID "getpid")
(PUNCT "(")
(PUNCT ")")
(PUNCT "!=")
(ID "self")
(PUNCT ".")
(ID "_lastpid")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "__init__")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT ".")
(ID "_lock")
(PUNCT ".")
(ID "acquire")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_free_pending_blocks")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "size")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_roundup")
(PUNCT "(")
(ID "max")
(PUNCT "(")
(ID "size")
(PUNCT ",")
(LIT 1)
(PUNCT ")")
(PUNCT ",")
(ID "self")
(PUNCT ".")
(ID "_alignment")
(PUNCT ")")
(NEWLINE)
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_malloc")
(PUNCT "(")
(ID "size")
(PUNCT ")")
(NEWLINE)
(ID "new_stop")
(PUNCT "=")
(ID "start")
(PUNCT "+")
(ID "size")
(NEWLINE)
(KEYWORD if)
(ID "new_stop")
(PUNCT "<")
(ID "stop")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_free")
(PUNCT "(")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "new_stop")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "block")
(PUNCT "=")
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ",")
(ID "new_stop")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_allocated_blocks")
(PUNCT ".")
(ID "add")
(PUNCT "(")
(ID "block")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "block")
(NEWLINE)
(DEDENT)
(KEYWORD finally)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "_lock")
(PUNCT ".")
(ID "release")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "BufferWrapper")
(PUNCT "(")
(ID "object")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "_heap")
(PUNCT "=")
(ID "Heap")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "size")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD assert)
(LIT 0)
(PUNCT "<=")
(ID "size")
(PUNCT "<")
(ID "sys")
(PUNCT ".")
(ID "maxsize")
(NEWLINE)
(ID "block")
(PUNCT "=")
(ID "BufferWrapper")
(PUNCT ".")
(ID "_heap")
(PUNCT ".")
(ID "malloc")
(PUNCT "(")
(ID "size")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "_state")
(PUNCT "=")
(PUNCT "(")
(ID "block")
(PUNCT ",")
(ID "size")
(PUNCT ")")
(NEWLINE)
(ID "util")
(PUNCT ".")
(ID "Finalize")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "BufferWrapper")
(PUNCT ".")
(ID "_heap")
(PUNCT ".")
(ID "free")
(PUNCT ",")
(ID "args")
(PUNCT "=")
(PUNCT "(")
(ID "block")
(PUNCT ",")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "create_memoryview")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(PUNCT "(")
(ID "arena")
(PUNCT ",")
(ID "start")
(PUNCT ",")
(ID "stop")
(PUNCT ")")
(PUNCT ",")
(ID "size")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "_state")
(NEWLINE)
(KEYWORD return)
(ID "memoryview")
(PUNCT "(")
(ID "arena")
(PUNCT ".")
(ID "buffer")
(PUNCT ")")
(PUNCT "[")
(ID "start")
(PUNCT ":")
(ID "start")
(PUNCT "+")
(ID "size")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(DEDENT)
(ENDMARKER)
