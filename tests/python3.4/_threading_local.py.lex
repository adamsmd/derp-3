(LIT "Thread-local objects.\n\n(Note that this module provides a Python version of the threading.local\n class.  Depending on the version of Python you're using, there may be a\n faster one available.  You should always import the `local` class from\n `threading`.)\n\nThread-local objects support the management of thread-local data.\nIf you have data that you want to be local to a thread, simply create\na thread-local object and use its attributes:\n\n  >>> mydata = local()\n  >>> mydata.number = 42\n  >>> mydata.number\n  42\n\nYou can also access the local-object's dictionary:\n\n  >>> mydata.__dict__\n  {'number': 42}\n  >>> mydata.__dict__.setdefault('widgets', [])\n  []\n  >>> mydata.widgets\n  []\n\nWhat's important about thread-local objects is that their data are\nlocal to a thread. If we access the data in a different thread:\n\n  >>> log = []\n  >>> def f():\n  ...     items = sorted(mydata.__dict__.items())\n  ...     log.append(items)\n  ...     mydata.number = 11\n  ...     log.append(mydata.number)\n\n  >>> import threading\n  >>> thread = threading.Thread(target=f)\n  >>> thread.start()\n  >>> thread.join()\n  >>> log\n  [[], 11]\n\nwe get different data.  Furthermore, changes made in the other thread\ndon't affect data seen in this thread:\n\n  >>> mydata.number\n  42\n\nOf course, values you get from a local object, including a __dict__\nattribute, are for whatever thread was current at the time the\nattribute was read.  For that reason, you generally don't want to save\nthese values across threads, as they apply only to the thread they\ncame from.\n\nYou can create custom local objects by subclassing the local class:\n\n  >>> class MyLocal(local):\n  ...     number = 2\n  ...     initialized = False\n  ...     def __init__(self, **kw):\n  ...         if self.initialized:\n  ...             raise SystemError('__init__ called too many times')\n  ...         self.initialized = True\n  ...         self.__dict__.update(kw)\n  ...     def squared(self):\n  ...         return self.number ** 2\n\nThis can be useful to support default values, methods and\ninitialization.  Note that if you define an __init__ method, it will be\ncalled each time the local object is used in a separate thread.  This\nis necessary to initialize each thread's dictionary.\n\nNow if we create a local object:\n\n  >>> mydata = MyLocal(color='red')\n\nNow we have a default number:\n\n  >>> mydata.number\n  2\n\nan initial color:\n\n  >>> mydata.color\n  'red'\n  >>> del mydata.color\n\nAnd a method that operates on the data:\n\n  >>> mydata.squared()\n  4\n\nAs before, we can access the data in a separate thread:\n\n  >>> log = []\n  >>> thread = threading.Thread(target=f)\n  >>> thread.start()\n  >>> thread.join()\n  >>> log\n  [[('color', 'red'), ('initialized', True)], 11]\n\nwithout affecting this thread's data:\n\n  >>> mydata.number\n  2\n  >>> mydata.color\n  Traceback (most recent call last):\n  ...\n  AttributeError: 'MyLocal' object has no attribute 'color'\n\nNote that subclasses can define slots, but they are not thread\nlocal. They are shared across threads:\n\n  >>> class MyLocal(local):\n  ...     __slots__ = 'number'\n\n  >>> mydata = MyLocal()\n  >>> mydata.number = 42\n  >>> mydata.color = 'red'\n\nSo, the separate thread:\n\n  >>> thread = threading.Thread(target=f)\n  >>> thread.start()\n  >>> thread.join()\n\naffects what we see:\n\n  >>> mydata.number\n  11\n\n>>> del mydata\n")
(NEWLINE)
(KEYWORD from)
(ID "weakref")
(KEYWORD import)
(ID "ref")
(NEWLINE)
(KEYWORD from)
(ID "contextlib")
(KEYWORD import)
(ID "contextmanager")
(NEWLINE)
(ID "__all__")
(PUNCT "=")
(PUNCT "[")
(LIT "local")
(PUNCT "]")
(NEWLINE)
(KEYWORD class)
(ID "_localimpl")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "A class managing thread-local dicts")
(NEWLINE)
(ID "__slots__")
(PUNCT "=")
(LIT "key")
(PUNCT ",")
(LIT "dicts")
(PUNCT ",")
(LIT "localargs")
(PUNCT ",")
(LIT "locallock")
(PUNCT ",")
(LIT "__weakref__")
(NEWLINE)
(KEYWORD def)
(ID "__init__")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "self")
(PUNCT ".")
(ID "key")
(PUNCT "=")
(LIT "_threading_local._localimpl.")
(PUNCT "+")
(ID "str")
(PUNCT "(")
(ID "id")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ")")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "dicts")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "get_dict")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Return the dict for the current thread. Raises KeyError if none\n        defined.")
(NEWLINE)
(ID "thread")
(PUNCT "=")
(ID "current_thread")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(PUNCT ".")
(ID "dicts")
(PUNCT "[")
(ID "id")
(PUNCT "(")
(ID "thread")
(PUNCT ")")
(PUNCT "]")
(PUNCT "[")
(LIT 1)
(PUNCT "]")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "create_dict")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(LIT "Create a new dict for the current thread, and return it.")
(NEWLINE)
(ID "localdict")
(PUNCT "=")
(PUNCT "{")
(PUNCT "}")
(NEWLINE)
(ID "key")
(PUNCT "=")
(ID "self")
(PUNCT ".")
(ID "key")
(NEWLINE)
(ID "thread")
(PUNCT "=")
(ID "current_thread")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "idt")
(PUNCT "=")
(ID "id")
(PUNCT "(")
(ID "thread")
(PUNCT ")")
(NEWLINE)
(KEYWORD def)
(ID "local_deleted")
(PUNCT "(")
(ID "_")
(PUNCT ",")
(ID "key")
(PUNCT "=")
(ID "key")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "thread")
(PUNCT "=")
(ID "wrthread")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "thread")
(KEYWORD is)
(KEYWORD not)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD del)
(ID "thread")
(PUNCT ".")
(ID "__dict__")
(PUNCT "[")
(ID "key")
(PUNCT "]")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "thread_deleted")
(PUNCT "(")
(ID "_")
(PUNCT ",")
(ID "idt")
(PUNCT "=")
(ID "idt")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "local")
(PUNCT "=")
(ID "wrlocal")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD if)
(ID "local")
(KEYWORD is)
(KEYWORD not)
(KEYWORD None)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "dct")
(PUNCT "=")
(ID "local")
(PUNCT ".")
(ID "dicts")
(PUNCT ".")
(ID "pop")
(PUNCT "(")
(ID "idt")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(ID "wrlocal")
(PUNCT "=")
(ID "ref")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "local_deleted")
(PUNCT ")")
(NEWLINE)
(ID "wrthread")
(PUNCT "=")
(ID "ref")
(PUNCT "(")
(ID "thread")
(PUNCT ",")
(ID "thread_deleted")
(PUNCT ")")
(NEWLINE)
(ID "thread")
(PUNCT ".")
(ID "__dict__")
(PUNCT "[")
(ID "key")
(PUNCT "]")
(PUNCT "=")
(ID "wrlocal")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "dicts")
(PUNCT "[")
(ID "idt")
(PUNCT "]")
(PUNCT "=")
(ID "wrthread")
(PUNCT ",")
(ID "localdict")
(NEWLINE)
(KEYWORD return)
(ID "localdict")
(NEWLINE)
(DEDENT)
(DEDENT)
(PUNCT "@")
(ID "contextmanager")
(NEWLINE)
(KEYWORD def)
(ID "_patch")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "impl")
(PUNCT "=")
(ID "object")
(PUNCT ".")
(ID "__getattribute__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(LIT "_local__impl")
(PUNCT ")")
(NEWLINE)
(KEYWORD try)
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "dct")
(PUNCT "=")
(ID "impl")
(PUNCT ".")
(ID "get_dict")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD except)
(ID "KeyError")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "dct")
(PUNCT "=")
(ID "impl")
(PUNCT ".")
(ID "create_dict")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "args")
(PUNCT ",")
(ID "kw")
(PUNCT "=")
(ID "impl")
(PUNCT ".")
(ID "localargs")
(NEWLINE)
(ID "self")
(PUNCT ".")
(ID "__init__")
(PUNCT "(")
(PUNCT "*")
(ID "args")
(PUNCT ",")
(PUNCT "**")
(ID "kw")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD with)
(ID "impl")
(PUNCT ".")
(ID "locallock")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "object")
(PUNCT ".")
(ID "__setattr__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(LIT "__dict__")
(PUNCT ",")
(ID "dct")
(PUNCT ")")
(NEWLINE)
(KEYWORD yield)
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD class)
(ID "local")
(PUNCT ":")
(NEWLINE)
(INDENT)
(ID "__slots__")
(PUNCT "=")
(LIT "_local__impl")
(PUNCT ",")
(LIT "__dict__")
(NEWLINE)
(KEYWORD def)
(ID "__new__")
(PUNCT "(")
(ID "cls")
(PUNCT ",")
(PUNCT "*")
(ID "args")
(PUNCT ",")
(PUNCT "**")
(ID "kw")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(PUNCT "(")
(ID "args")
(KEYWORD or)
(ID "kw")
(PUNCT ")")
(KEYWORD and)
(PUNCT "(")
(ID "cls")
(PUNCT ".")
(ID "__init__")
(KEYWORD is)
(ID "object")
(PUNCT ".")
(ID "__init__")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(ID "TypeError")
(PUNCT "(")
(LIT "Initialization arguments are not supported")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(ID "self")
(PUNCT "=")
(ID "object")
(PUNCT ".")
(ID "__new__")
(PUNCT "(")
(ID "cls")
(PUNCT ")")
(NEWLINE)
(ID "impl")
(PUNCT "=")
(ID "_localimpl")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "impl")
(PUNCT ".")
(ID "localargs")
(PUNCT "=")
(PUNCT "(")
(ID "args")
(PUNCT ",")
(ID "kw")
(PUNCT ")")
(NEWLINE)
(ID "impl")
(PUNCT ".")
(ID "locallock")
(PUNCT "=")
(ID "RLock")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(ID "object")
(PUNCT ".")
(ID "__setattr__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(LIT "_local__impl")
(PUNCT ",")
(ID "impl")
(PUNCT ")")
(NEWLINE)
(ID "impl")
(PUNCT ".")
(ID "create_dict")
(PUNCT "(")
(PUNCT ")")
(NEWLINE)
(KEYWORD return)
(ID "self")
(NEWLINE)
(DEDENT)
(KEYWORD def)
(ID "__getattribute__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "name")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD with)
(ID "_patch")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "object")
(PUNCT ".")
(ID "__getattribute__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "name")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "__setattr__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "name")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "name")
(PUNCT "==")
(LIT "__dict__")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(ID "AttributeError")
(PUNCT "(")
(LIT "%r object attribute '__dict__' is read-only")
(PUNCT "%")
(ID "self")
(PUNCT ".")
(ID "__class__")
(PUNCT ".")
(ID "__name__")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD with)
(ID "_patch")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "object")
(PUNCT ".")
(ID "__setattr__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "name")
(PUNCT ",")
(ID "value")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(KEYWORD def)
(ID "__delattr__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "name")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD if)
(ID "name")
(PUNCT "==")
(LIT "__dict__")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD raise)
(ID "AttributeError")
(PUNCT "(")
(LIT "%r object attribute '__dict__' is read-only")
(PUNCT "%")
(ID "self")
(PUNCT ".")
(ID "__class__")
(PUNCT ".")
(ID "__name__")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(KEYWORD with)
(ID "_patch")
(PUNCT "(")
(ID "self")
(PUNCT ")")
(PUNCT ":")
(NEWLINE)
(INDENT)
(KEYWORD return)
(ID "object")
(PUNCT ".")
(ID "__delattr__")
(PUNCT "(")
(ID "self")
(PUNCT ",")
(ID "name")
(PUNCT ")")
(NEWLINE)
(DEDENT)
(DEDENT)
(DEDENT)
(KEYWORD from)
(ID "threading")
(KEYWORD import)
(ID "current_thread")
(PUNCT ",")
(ID "RLock")
(NEWLINE)
(ENDMARKER)
